{"version":3,"sources":["webpack://zeta/webpack/universalModuleDefinition","webpack://zeta/./src/env.js","webpack://zeta/./src/shim.js","webpack://zeta/./src/util.js","webpack://zeta/./src/domUtil.js","webpack://zeta/./src/cssUtil.js","webpack://zeta/./src/domLock.js","webpack://zeta/./src/dom.js","webpack://zeta/./src/events.js","webpack://zeta/./src/observe.js","webpack://zeta/./src/tree.js","webpack://zeta/./src/index.js","webpack://zeta/external \"promise-polyfill\"","webpack://zeta/external {\"commonjs\":\"jquery\",\"commonjs2\":\"jquery\",\"amd\":\"jquery\",\"root\":\"$\"}","webpack://zeta/webpack/bootstrap","webpack://zeta/webpack/startup","webpack://zeta/webpack/runtime/define property getters","webpack://zeta/webpack/runtime/hasOwnProperty shorthand","webpack://zeta/webpack/runtime/make namespace object"],"names":["root","factory","exports","module","require","define","amd","self","__WEBPACK_EXTERNAL_MODULE__44__","__WEBPACK_EXTERNAL_MODULE__804__","document","documentElement","IS_IOS","test","navigator","userAgent","window","MSStream","IS_IE10","ActiveXObject","IS_IE","undefined","style","msTouchAction","msUserSelect","IS_MAC","indexOf","IS_TOUCH","Map","map","key","items","this","_values","_keys","Set","prototype","length","has","v","get","index","set","i","push","delete","splice","keys","values","entries","forEach","callback","thisArg","call","clear","Iterator","arr","next","value","done","add","WeakMap","returnValue","num","state","Error","Object","defineProperty","configurable","hasOwnProperty","jQuery","Promise","matchWordCache","watchStore","freeze","getOwnPropertyDescriptor","getOwnPropertyNames","hasOwnPropertyImpl","propertyIsEnumerableImpl","propertyIsEnumerable","obj","vals","compareFn","b","setImmediateStore","noop","either","x","y","isArray","Array","isFunction","isThenable","then","isPlainObject","proto","getPrototypeOf","isArrayLike","makeArray","slice","each","extend","options","name","src","copy","copyIsArray","clone","target","arguments","deep","cur","split","len","nextNode","result","apply","grep","unshift","any","single","kv","mapGet","fn","mapRemove","equal","a","constructor","type","size","bind","createPrivateStore","setImmediate","args","resolve","setImmediateOnceCallback","setImmediateOnce","setTimeoutOnce","setTimeout","throwNotFunction","iequal","toLowerCase","randomId","Math","random","toString","substr","repeat","str","count","join","camel","String","replace","toUpperCase","hyphenate","ucfirst","charAt","lcfirst","trim","matchWord","haystack","needle","cache","RegExp","$1","htmlDecode","input","DOMParser","parseFromString","textContent","reject","reason","always","promise","resolveAll","all","d","catchAsync","catch","setPromiseTimeout","ms","resolveWhenTimeout","prop","getOwnPropertyDescriptors","props","o","p","definePrototype","defineOwnProperty","readonly","enumerable","writable","defineGetterProperty","defineHiddenProperty","inherit","setPrototypeOf","create","deepFreeze","getObservableState","sync","oldValues","newValues","alias","handlers","handleChanges","lock","defineAliasProperty","targetProp","desc","defineObservableProperty","initialValue","setter","oldValue","watch","handler","fireInit","e","watchOnce","watchable","originDiv","scrollbarWidth","selection","getSelection","elementsFromPoint","msElementsFromPoint","compareDocumentPositionImpl","compareDocumentPosition","compareBoundaryPointsImpl","Range","compareBoundaryPoints","OFFSET_ZERO","Rect","l","t","r","left","top","right","bottom","tagName","element","is","selector","toFixed","nodeType","$","sameElementSpec","thisAttr","attributes","prevAttr","nodeName","comparePosition","strict","NaN","connected","commonAncestorContainer","containsOrEquals","container","contained","isVisible","rect","getRect","width","height","parentNode","getComputedStyle","display","iterateNode","iterator","from","until","currentNode","node","whatToShow","Node","filter","acceptNode","iterateNodeToArray","getCommonAncestor","parentsAndSelf","parent","selectIncludeSelf","matched","find","selectClosestRelative","$matched","createDocumentFragment","DocumentFragment","append","createTextNode","text","createElement","createNodeIterator","createTreeWalker","addOrRemoveEventListener","method","event","listener","useCapture","unbind","bindUntil","dispatchDOMMouseEvent","eventName","point","elementFromPoint","clientX","clientY","createEvent","initMouseEvent","bubbles","cancelable","view","detail","screenX","screenY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","dispatchEvent","removeNode","removeChild","getClass","className","re","setClass","replaced","concat","getScrollOffset","winOrElm","pageXOffset","scrollLeft","pageYOffset","scrollTop","getScrollParent","s","overflow","position","scrollBy","body","orig","getContentRect","dummy","appendTo","children","hasOverflowX","offsetWidth","scrollWidth","hasOverflowY","offsetHeight","scrollHeight","parentRect","overflowY","overflowX","scrollIntoView","deltaX","max","min","deltaY","parentResult","translate","createRange","startNode","startOffset","endNode","endOffset","getRange","range","collapse","setStart","getOffset","setEnd","cloneRange","collapsed","inverse","startContainer","endContainer","rangeIntersects","rangeCovers","rangeEquals","compareRangePosition","abs","makeSelection","setBaseAndExtent","removeAllRanges","createTextRange","select","addRange","rangeCount","elm","includeMargin","div","appendChild","toPlainRect","getBoundingClientRect","marginTop","parseFloat","marginLeft","marginRight","marginBottom","expand","offset","childNodes","getRects","getClientRects","clip","round","rectEquals","check","rectCovers","rectIntersects","pointInRect","within","mergeRect","pointerEvents","tmp","parentsUntil","css","parseCSS","styles","setAttribute","isCssUrlValue","$2","$3","animatableValue","allowNumber","removeVendorPrefix","runCSSTransition","map1","pseudoElement","transitionDuration","animationName","transitionProperty","targets","newStyle","appendPseudoToAnim","AnimationEvent","curStyle","transitionProperties","dict","j","curValue","newValue","prevAnim","propertyName","side","pos","w","h","dx","dy","lockedElements","handledErrors","_","retryable","oncancel","DOMLock","wait","locked","parents","removeLock","cancel","promises","afterDetached","force","emitDOMEvent","deferred","reduce","finish","error","cancelled","onbeforeunload","preventDefault","windowFocusedOut","currentEvent","KEYNAMES","JSON","parse","SELECTOR_FOCUSABLE","META_KEYS","focusPath","focusFriends","focusElements","modalElements","domReady","approxMultipleOf","measureLine","p1","p2","deg","atan2","PI","sqrt","textInputAllowed","isContentEditable","focused","activeElement","focusable","friends","triggerFocusEvent","elements","source","getContainer","setFocus","focusOnInput","path","lockParent","focusLockedWithin","removed","added","friend","ZetaEventSource","focus","blur","modifierCount","modifiedKeyCode","mouseInitialPoint","mousedownFocus","normalizeTouchEvents","pressTimeout","imeNode","imeOffset","imeText","getEventName","suffix","mod","updateIMEState","selectionEnd","anchorNode","anchorOffset","child","triggerUIEvent","data","triggerKeystrokeEvent","keyName","char","lastEventSource","triggerMouseEvent","nativeEvent","metakey","triggerGestureEvent","gesture","stopPropagation","stopImmediatePropagation","setLastEventSource","compositionstart","compositionupdate","compositionend","isInputElm","prevText","prevOffset","curText","o1","o2","newText","setSelectionRange","textInput","keydown","keyCode","isModifierKey","isSpecialKey","keyup","keypress","fromCharCode","charCode","synthetic","beforeinput","inputType","touchstart","touches","touchmove","clearTimeout","line","touchend","mousedown","buttons","which","mousemove","mouseup","wheel","dir","click","contextmenu","dblclick","focusin","focusout","registerCleanup","modelPath","context","getEventSource","ready","setModal","focusWithin","retainFocus","releaseFocus","on","domContainer","emit","cancelLock","observe","watchElements","collection","remove","optionsForChildList","removedNodes","addedNodes","dom","watchAttributes","subtree","attributeFilter","records","detachHandlers","childList","MutationObserver","takeRecords","init","prevValue","record","attrName","attributeName","attributeOldValue","characterDataOldValue","some","DetachHandlerState","processRecords","id","observer","initDetachWatcher","eventSource","containers","domEventTrap","ZetaEventContainer","asyncEventData","asyncEvents","getEventSourceName","sourceKeyName","exact","emitter","ZetaEventEmitter","emitAsyncEvents","events","originalEvent","properties","timestamp","performance","now","sourceObj","emitterCallHandlers","component","handlerName","removeAsyncEvent","contextContainer","ZetaEvent","prevEventSource","prevEvent","console","components","autoDestroy","captureDOMEvents","setContext","destroy","containerCreateContext","Element","handled","isHandled","defaultPrevented","isDefaultPrevented","tap","getContext","emitAsync","mergeData","registerAsyncEvent","flushEvents","collectMutations","mutations","empty","addedElm","removedElm","version","versionMap","throwOrReturn","throwError","message","VersionState","initNode","tree","sNode","traversable","TraversableNode","nodes","detached","rootNode","insertNode","findNode","returnParent","sTree","findParent","checkNodeState","updateTree","insertTraversableNode","insertInheritedNode","keepNode","removeTraversableNode","removeInheritedNode","insertChildNode","sParent","sChild","parentChildNodes","s1","s2","previousSilbing","nextSibling","states","updated","InheritedNode","updatedNodes","newVersion","sort","reorderTraversableChildNodes","recovered","createNodeClass","baseClass","VirtualNode","NodeTree","nodeClass","setNode","TraversableNodeTree","InheritedNodeTree","getComputedValues","getNode","assertDescendantOfTree","assertSameTree","env","util","_util","_domUtil","shim","cssUtil","EventContainer","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__","definition","Symbol","toStringTag"],"mappings":"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","file":"zeta.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"jquery\"), require(\"promise-polyfill\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"zeta\", [\"jquery\", \"promise-polyfill\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"zeta\"] = factory(require(\"jquery\"), require(\"promise-polyfill\"));\n\telse\n\t\troot[\"zeta\"] = factory(root[\"$\"], root[\"promise-polyfill\"]);\n})(self, function(__WEBPACK_EXTERNAL_MODULE__44__, __WEBPACK_EXTERNAL_MODULE__804__) {\nreturn ","// @ts-nocheck\r\nconst root = document.documentElement;\r\n\r\nexport const IS_IOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\r\nexport const IS_IE10 = !!window.ActiveXObject;\r\nexport const IS_IE = !!window.ActiveXObject || root.style.msTouchAction !== undefined || root.style.msUserSelect !== undefined;\r\nexport const IS_MAC = navigator.userAgent.indexOf('Macintosh') >= 0;\r\nexport const IS_TOUCH = 'ontouchstart' in window;\r\n","// @ts-nocheck\r\n\r\nconst Map = window.Map || (function () {\r\n    function indexOf(map, key) {\r\n        return map.items.indexOf(key);\r\n    }\r\n    function Map() {\r\n        var self = this;\r\n        self.items = [];\r\n        self._values = [];\r\n        self._keys = Set.prototype._keys;\r\n    }\r\n    Map.prototype = {\r\n        get size() {\r\n            return this.items.length;\r\n        },\r\n        has: function (v) {\r\n            return indexOf(this, v) >= 0;\r\n        },\r\n        get: function (v) {\r\n            var index = indexOf(this, v);\r\n            return index >= 0 ? this._values[index] : undefined;\r\n        },\r\n        set: function (i, v) {\r\n            var self = this;\r\n            var index = indexOf(self, i);\r\n            self._values[index >= 0 ? index : self.items.push(i) - 1] = v;\r\n            return self;\r\n        },\r\n        delete: function (v) {\r\n            var self = this;\r\n            var index = indexOf(self, v);\r\n            if (index >= 0) {\r\n                self.items.splice(index, 1);\r\n                self._values.splice(index, 1);\r\n            }\r\n            return index >= 0;\r\n        },\r\n        keys: function () {\r\n            return this._keys();\r\n        },\r\n        values: function () {\r\n            var self = this;\r\n            return self._keys(function (v) {\r\n                return self.get(v);\r\n            });\r\n        },\r\n        entries: function () {\r\n            var self = this;\r\n            return self._keys(function (v) {\r\n                return [v, self.get(v)];\r\n            });\r\n        },\r\n        forEach: function (callback, thisArg) {\r\n            var self = this;\r\n            self.items.forEach(function (v, i) {\r\n                callback.call(thisArg, self._values[i], v, self);\r\n            });\r\n        },\r\n        clear: function () {\r\n            this.items.splice(0);\r\n            this._values.splice(0);\r\n        }\r\n    };\r\n    return Map;\r\n}());\r\n\r\nconst Set = window.Set || (function () {\r\n    function Iterator(arr, callback) {\r\n        var self = this;\r\n        self.items = arr;\r\n        self.index = -1;\r\n        self.callback = callback || function (v) {\r\n            return v;\r\n        };\r\n    }\r\n    Iterator.prototype = {\r\n        next: function () {\r\n            var self = this;\r\n            if (++self.index < self.items.length) {\r\n                return {\r\n                    value: self.callback(self.items[self.index], self.index),\r\n                    done: false\r\n                };\r\n            }\r\n            return {\r\n                value: undefined,\r\n                done: true\r\n            };\r\n        }\r\n    };\r\n\r\n    function Set() {\r\n        this.items = [];\r\n    }\r\n    Set.prototype = {\r\n        get size() {\r\n            return this.items.length;\r\n        },\r\n        has: function (v) {\r\n            return this.items.indexOf(v) >= 0;\r\n        },\r\n        add: function (v) {\r\n            var items = this.items;\r\n            if (items.indexOf(v) < 0) {\r\n                items.push(v);\r\n            }\r\n            return this;\r\n        },\r\n        delete: function (v) {\r\n            var index = this.items.indexOf(v);\r\n            if (index >= 0) {\r\n                this.items.splice(index, 1);\r\n            }\r\n            return index >= 0;\r\n        },\r\n        keys: function () {\r\n            return this._keys();\r\n        },\r\n        values: function () {\r\n            return this._keys();\r\n        },\r\n        entries: function () {\r\n            return this._keys(function (v) {\r\n                return [v, v];\r\n            });\r\n        },\r\n        forEach: function (callback, thisArg) {\r\n            var self = this;\r\n            self.items.forEach(function (v) {\r\n                callback.call(thisArg, v, v, self);\r\n            });\r\n        },\r\n        clear: function () {\r\n            this.items.splice(0);\r\n        },\r\n        _keys: function (callback) {\r\n            return new Iterator(this.items, callback);\r\n        }\r\n    };\r\n    return Set;\r\n}());\r\n\r\nconst WeakMap = window.WeakMap || (function () {\r\n    var num = 0;\r\n    var state = 0;\r\n    var returnValue;\r\n\r\n    function WeakMap() {\r\n        this.key = '__WeakMap' + (++num);\r\n    }\r\n    WeakMap.prototype = {\r\n        get: function (key) {\r\n            if (this.has(key)) {\r\n                try {\r\n                    state = 1;\r\n                    key[this.key]();\r\n                    if (state !== 2) {\r\n                        throw new Error('Invalid operation');\r\n                    }\r\n                    var value = returnValue;\r\n                    returnValue = null;\r\n                    return value;\r\n                } finally {\r\n                    state = 0;\r\n                }\r\n            }\r\n        },\r\n        set: function (key, value) {\r\n            Object.defineProperty(key, this.key, {\r\n                configurable: true,\r\n                value: function () {\r\n                    if (state === 1) {\r\n                        returnValue = value;\r\n                        state = 2;\r\n                    }\r\n                }\r\n            });\r\n            return this;\r\n        },\r\n        has: function (key) {\r\n            return key && Object.hasOwnProperty.call(key, this.key);\r\n        },\r\n        delete: function (key) {\r\n            var has = this.has(key);\r\n            if (has) {\r\n                delete key[this.key];\r\n            }\r\n            return has;\r\n        }\r\n    };\r\n    return WeakMap;\r\n}());\r\n\r\nconst useRequire = typeof require === 'function';\r\nconst jQuery = window.jQuery || (useRequire && require('jquery'));\r\nconst Promise = window.Promise || (useRequire && require('promise-polyfill').default);\r\n\r\nexport {\r\n    jQuery as $,\r\n    Promise,\r\n    Map,\r\n    Set,\r\n    WeakMap\r\n};\r\n","import { Map, Set, WeakMap, Promise } from \"./shim.js\";\r\n\r\nconst keys = Object.keys;\r\nconst freeze = Object.freeze;\r\nconst defineProperty = Object.defineProperty;\r\nconst getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\r\nconst getOwnPropertyNames = Object.getOwnPropertyNames;\r\nconst hasOwnPropertyImpl = Object.prototype.hasOwnProperty;\r\nconst propertyIsEnumerableImpl = Object.prototype.propertyIsEnumerable;\r\nconst values = Object.values || function (obj) {\r\n    var vals = [];\r\n    for (var key in obj) {\r\n        if (hasOwnPropertyImpl.call(obj, key) && propertyIsEnumerableImpl.call(obj, key)) {\r\n            vals.push(obj[key]);\r\n        }\r\n    }\r\n    return vals;\r\n};\r\n\r\nconst compareFn = [\r\n    function (b, v, i) { return b[i] !== v; },\r\n    function (b, v, i) { return b.get(i) !== v; },\r\n    function (b, v, i) { return !b.has(v); }\r\n];\r\n\r\nvar setImmediateStore = new Map();\r\nvar matchWordCache;\r\nvar watchStore;\r\n\r\n/* --------------------------------------\r\n * Miscellaneous\r\n * -------------------------------------- */\r\n\r\nfunction noop() { }\r\n\r\nfunction either(x, y) {\r\n    return x ^ y;\r\n}\r\n\r\nfunction isArray(obj) {\r\n    return Array.isArray(obj) && obj;\r\n}\r\n\r\nfunction isFunction(obj) {\r\n    return typeof obj === 'function' && obj;\r\n}\r\n\r\nfunction isThenable(obj) {\r\n    return !!obj && isFunction(obj.then) && obj;\r\n}\r\n\r\nfunction isPlainObject(obj) {\r\n    var proto = typeof obj === 'object' && obj !== null && Object.getPrototypeOf(obj);\r\n    return (proto === Object.prototype || proto === null) && obj;\r\n}\r\n\r\nfunction isArrayLike(obj) {\r\n    if (isFunction(obj) || obj === window) {\r\n        return false;\r\n    }\r\n    var length = !!obj && 'length' in obj && obj.length;\r\n    return isArray(obj) || length === 0 || (typeof length === 'number' && length > 0 && (length - 1) in obj);\r\n}\r\n\r\nfunction makeArray(obj) {\r\n    if (isArray(obj)) {\r\n        return obj.slice(0);\r\n    }\r\n    if (typeof obj === 'string') {\r\n        return [obj];\r\n    }\r\n    if (obj && (isArrayLike(obj) || isFunction(obj.forEach))) {\r\n        var arr = [];\r\n        each(obj, function (i, v) {\r\n            arr[arr.length] = v;\r\n        });\r\n        return arr;\r\n    }\r\n    return obj !== null && obj !== undefined ? [obj] : [];\r\n}\r\n\r\nfunction extend() {\r\n    var options, name, src, copy, copyIsArray, clone;\r\n    var target = arguments[0] || {};\r\n    var i = 1;\r\n    var length = arguments.length;\r\n    var deep = false;\r\n\r\n    if (typeof target === 'boolean') {\r\n        deep = target;\r\n        target = arguments[i] || {};\r\n        i++;\r\n    }\r\n    if (typeof target !== 'object' && !isFunction(target)) {\r\n        target = {};\r\n    }\r\n    for (; i < length; i++) {\r\n        if ((options = arguments[i]) !== null) {\r\n            for (name in options) {\r\n                src = target[name];\r\n                copy = options[name];\r\n\r\n                // prevent never-ending loop\r\n                if (target === copy) {\r\n                    continue;\r\n                }\r\n                // recurse if we're merging plain objects or arrays\r\n                if (deep && copy && (isPlainObject(copy) || (copyIsArray = isArray(copy)))) {\r\n                    if (copyIsArray) {\r\n                        copyIsArray = false;\r\n                        clone = src && isArray(src) ? src : [];\r\n                    } else {\r\n                        clone = src && isPlainObject(src) ? src : {};\r\n                    }\r\n                    // never move original objects, clone them\r\n                    target[name] = extend(deep, clone, copy);\r\n                } else if (copy !== undefined) {\r\n                    // don't bring in undefined values\r\n                    target[name] = copy;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return target;\r\n}\r\n\r\nfunction each(obj, callback) {\r\n    if (obj) {\r\n        var cur, i = 0;\r\n        if (typeof obj === 'string') {\r\n            obj = obj.split(' ');\r\n        } else if (obj instanceof Set) {\r\n            // would be less useful if key and value refers to the same object\r\n            obj = isFunction(obj.values) ? obj.values() : (function (obj, arr) {\r\n                return obj.forEach(function (v) {\r\n                    // @ts-ignore: arr is hinted as never[]\r\n                    arr[arr.length] = v;\r\n                }), arr;\r\n            }(obj, []));\r\n        }\r\n        if (isArrayLike(obj)) {\r\n            var len = obj.length;\r\n            while (i < len && callback(i, obj[i++]) !== false);\r\n        } else if (isFunction(obj.entries)) {\r\n            obj = obj.entries();\r\n            while (!(cur = obj.next()).done && callback(cur.value[0], cur.value[1]) !== false);\r\n        } else if (isFunction(obj.forEach)) {\r\n            var value;\r\n            obj.forEach(function (v, i) {\r\n                value = value === false || callback(i, v);\r\n            });\r\n        } else if (isFunction(obj.next)) {\r\n            while (!(cur = obj.next()).done && callback(i++, cur.value) !== false);\r\n        } else if (isFunction(obj.nextNode)) {\r\n            while ((cur = obj.nextNode()) && callback(i++, cur) !== false);\r\n        } else {\r\n            // @ts-ignore: i is unused elsewhere thus can be assigned string\r\n            for (i in obj) {\r\n                if (callback(i, obj[i]) === false) {\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction map(obj, callback) {\r\n    var arr = [];\r\n    each(obj, function (i, v) {\r\n        var result = callback.call(this, v, i);\r\n        if (result !== null && result !== undefined) {\r\n            if (isArray(result)) {\r\n                arr.push.apply(arr, result);\r\n            } else {\r\n                arr[arr.length] = result;\r\n            }\r\n        }\r\n    });\r\n    return arr;\r\n}\r\n\r\nfunction grep(obj, callback) {\r\n    var arr = [];\r\n    each(obj, function (i, v) {\r\n        if (callback.call(this, v, i)) {\r\n            arr[arr.length] = v;\r\n        }\r\n    });\r\n    return arr;\r\n}\r\n\r\nfunction splice(arr, callback) {\r\n    var result = [];\r\n    for (var i = arr.length - 1; i >= 0; i--) {\r\n        if (callback.call(arr, arr[i], i)) {\r\n            result.unshift(arr.splice(i, 1)[0]);\r\n        }\r\n    }\r\n    return result;\r\n}\r\n\r\nfunction any(obj, callback) {\r\n    var result = false;\r\n    each(obj, function (i, v) {\r\n        if (callback.call(this, v, i)) {\r\n            result = v;\r\n            return false;\r\n        }\r\n    });\r\n    return result;\r\n}\r\n\r\nfunction single(obj, callback) {\r\n    var result;\r\n    each(obj, function (i, v) {\r\n        result = callback.call(this, v, i);\r\n        return !result;\r\n    });\r\n    return result;\r\n}\r\n\r\nfunction kv(key, value) {\r\n    var obj = {};\r\n    obj[key] = value;\r\n    return obj;\r\n}\r\n\r\nfunction mapGet(map, key, fn) {\r\n    return map.get(key) || fn && (map.set(key, new fn()), map.get(key));\r\n}\r\n\r\nfunction mapRemove(map, key) {\r\n    var value = map.get(key);\r\n    map.delete(key);\r\n    return value;\r\n}\r\n\r\nfunction equal(a, b) {\r\n    if (typeof a !== 'object' || !b || a.constructor !== b.constructor) {\r\n        return a === b;\r\n    }\r\n    var type = (a instanceof Map && 1) || (a instanceof Set && 2) || (isArray(a) && 3) || 0;\r\n    if (a.length !== b.length || a.size !== b.size || (!type && keys(a).length !== keys(b).length)) {\r\n        return false;\r\n    }\r\n    return !single(a, (compareFn[type] || compareFn[0]).bind(0, b));\r\n}\r\n\r\nfunction createPrivateStore() {\r\n    var map = new WeakMap();\r\n    return function (obj, value) {\r\n        if (value) {\r\n            map.set(obj, value);\r\n        }\r\n        return value || map.get(obj);\r\n    };\r\n}\r\n\r\nfunction setImmediate(fn) {\r\n    var args = [].slice.call(arguments, 1);\r\n    resolve().then(function () {\r\n        fn.apply(undefined, args);\r\n    });\r\n}\r\n\r\nfunction setImmediateOnceCallback(fn) {\r\n    mapRemove(setImmediateStore, fn)();\r\n}\r\n\r\nfunction setImmediateOnce(fn) {\r\n    mapGet(setImmediateStore, fn, function () {\r\n        return setImmediate(setImmediateOnceCallback.bind(0, fn)), fn;\r\n    });\r\n}\r\n\r\nfunction setTimeoutOnce(fn) {\r\n    mapGet(setImmediateStore, fn, function () {\r\n        return setTimeout(setImmediateOnceCallback.bind(0, fn)), fn;\r\n    });\r\n}\r\n\r\n\r\n/* --------------------------------------\r\n * Throw helper\r\n * -------------------------------------- */\r\n\r\nfunction throwNotFunction(obj, name) {\r\n    if (!isFunction(obj)) {\r\n        throw new Error((name || 'callback') + ' must be a function');\r\n    }\r\n    return obj;\r\n}\r\n\r\n\r\n/* --------------------------------------\r\n * Strings\r\n * -------------------------------------- */\r\n\r\nfunction iequal(a, b) {\r\n    return a.toLowerCase() === b.toLowerCase();\r\n}\r\n\r\nfunction randomId() {\r\n    return Math.random().toString(36).substr(2, 8);\r\n}\r\n\r\nfunction repeat(str, count) {\r\n    return new Array(count + 1).join(str);\r\n}\r\n\r\nfunction camel(str) {\r\n    return String(str).replace(/-([a-z])/g, function (v, a) {\r\n        return a.toUpperCase();\r\n    });\r\n}\r\n\r\nfunction hyphenate(str) {\r\n    return String(str).replace(/[A-Z](?![A-Z])|[A-Z]{2,}(?=[A-Z])/g, function (v, a) {\r\n        return (a ? '-' : '') + v.toLowerCase();\r\n    });\r\n}\r\n\r\nfunction ucfirst(v) {\r\n    v = String(v || '');\r\n    return v.charAt(0).toUpperCase() + v.slice(1);\r\n}\r\n\r\nfunction lcfirst(v) {\r\n    v = String(v || '');\r\n    return v.charAt(0).toLowerCase() + v.slice(1);\r\n}\r\n\r\nfunction trim(v) {\r\n    return String(v || '').replace(/^(?:\\u200b|[^\\S\\u00a0])+|(?:\\u200b|[^\\S\\u00a0])+$/g, '');\r\n}\r\n\r\nfunction matchWord(haystack, needle) {\r\n    var cache = matchWordCache || (matchWordCache = {});\r\n    var re = cache[needle] || (cache[needle] = new RegExp('(?:^|\\\\s)(' + needle.replace(/\\s+/g, '|') + ')(?=$|\\\\s)'));\r\n    return re.test(String(haystack || '')) && RegExp.$1;\r\n}\r\n\r\nfunction htmlDecode(input) {\r\n    return input && new DOMParser().parseFromString(input, 'text/html').documentElement.textContent;\r\n}\r\n\r\n\r\n/* --------------------------------------\r\n * Promise related\r\n * -------------------------------------- */\r\n\r\nfunction resolve(value) {\r\n    return Promise.resolve(value);\r\n}\r\n\r\nfunction reject(reason) {\r\n    return Promise.reject(reason);\r\n}\r\n\r\nfunction always(promise, callback) {\r\n    return promise.then(function (v) {\r\n        return callback(true, v);\r\n    }, function (v) {\r\n        return callback(false, v);\r\n    });\r\n}\r\n\r\nfunction resolveAll(obj, callback) {\r\n    if (!obj || typeof obj !== 'object' || isThenable(obj)) {\r\n        return resolve(obj).then(callback);\r\n    }\r\n    if (isArray(obj)) {\r\n        return Promise.all(obj).then(callback);\r\n    }\r\n    var result = {};\r\n    var arr = map(obj, function (v, i) {\r\n        return resolve(v).then(function (d) {\r\n            result[i] = d;\r\n        });\r\n    });\r\n    return resolveAll(arr, function () {\r\n        return isFunction(callback) ? callback(result) : result;\r\n    });\r\n}\r\n\r\nfunction catchAsync(promise) {\r\n    return promise.catch(noop);\r\n}\r\n\r\nfunction setPromiseTimeout(promise, ms, resolveWhenTimeout) {\r\n    return new Promise(function (resolve, reject) {\r\n        promise.then(resolve, reject);\r\n        setTimeout(function () {\r\n            (resolveWhenTimeout ? resolve : reject)('timeout');\r\n        }, ms);\r\n    });\r\n}\r\n\r\n\r\n/* --------------------------------------\r\n * Property and prototype\r\n * -------------------------------------- */\r\n\r\nfunction hasOwnProperty(obj, prop) {\r\n    return hasOwnPropertyImpl.call(obj, prop);\r\n}\r\n\r\nfunction getOwnPropertyDescriptors(obj) {\r\n    var props = {};\r\n    each(getOwnPropertyNames(obj || {}), function (i, v) {\r\n        props[v] = getOwnPropertyDescriptor(obj, v);\r\n    });\r\n    return props;\r\n}\r\n\r\nfunction define(o, p) {\r\n    o = extend(function () { }, { prototype: o });\r\n    definePrototype(o, p);\r\n}\r\n\r\nfunction defineOwnProperty(obj, name, value, readonly) {\r\n    defineProperty(obj, name, {\r\n        configurable: true,\r\n        enumerable: true,\r\n        writable: !readonly,\r\n        value: value\r\n    });\r\n}\r\n\r\nfunction defineGetterProperty(obj, name, get, set) {\r\n    defineProperty(obj, name, {\r\n        configurable: true,\r\n        enumerable: true,\r\n        get: get,\r\n        set: set\r\n    });\r\n}\r\n\r\nfunction defineHiddenProperty(obj, name, value, readonly) {\r\n    defineProperty(obj, name, {\r\n        configurable: true,\r\n        enumerable: false,\r\n        writable: !readonly,\r\n        value: value\r\n    });\r\n}\r\n\r\nfunction definePrototype(fn, prototype, props) {\r\n    if (isFunction(prototype)) {\r\n        props = props || {};\r\n        fn.prototype = inherit(prototype, props);\r\n        defineHiddenProperty(fn.prototype, 'constructor', fn);\r\n        Object.setPrototypeOf(fn, prototype);\r\n        prototype = props;\r\n    }\r\n    each(getOwnPropertyDescriptors(prototype), function (i, v) {\r\n        v.enumerable = !isFunction(v.value);\r\n        defineProperty(fn.prototype, i, v);\r\n    });\r\n}\r\n\r\nfunction inherit(proto, props) {\r\n    var obj = Object.create(isFunction(proto) ? proto.prototype : proto || Object.prototype);\r\n    define(obj, props);\r\n    return obj;\r\n}\r\n\r\nfunction deepFreeze(obj) {\r\n    freeze(obj);\r\n    getOwnPropertyNames(obj).forEach(function (v) {\r\n        var value = obj[v];\r\n        if (value && typeof value === 'object') {\r\n            deepFreeze(value);\r\n        }\r\n    });\r\n    return obj;\r\n}\r\n\r\n\r\n/* --------------------------------------\r\n * Observable\r\n * -------------------------------------- */\r\n\r\nfunction getObservableState(obj, sync) {\r\n    var cache = watchStore || (watchStore = createPrivateStore());\r\n    return cache(obj) || cache(obj, {\r\n        sync: !!sync,\r\n        values: {},\r\n        oldValues: {},\r\n        newValues: {},\r\n        alias: {},\r\n        handlers: [],\r\n        handleChanges: function (callback) {\r\n            var self = cache(obj);\r\n            try {\r\n                self.lock = true;\r\n                do {\r\n                    var oldValues = self.oldValues;\r\n                    var newValues = self.newValues;\r\n                    if (isFunction(callback)) {\r\n                        callback();\r\n                    }\r\n                    if (getOwnPropertyNames(oldValues)[0]) {\r\n                        for (var i in oldValues) {\r\n                            if (oldValues[i] === newValues[i]) {\r\n                                delete oldValues[i];\r\n                                delete newValues[i];\r\n                            }\r\n                        }\r\n                        self.oldValues = {};\r\n                        self.newValues = {};\r\n                        self.handlers.slice(0).forEach(function (v) {\r\n                            v.call(obj, {\r\n                                oldValues: oldValues,\r\n                                newValues: newValues\r\n                            });\r\n                        });\r\n                    }\r\n                } while (self.sync && getOwnPropertyNames(self.oldValues)[0]);\r\n            } finally {\r\n                self.lock = false;\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nfunction defineAliasProperty(obj, prop, target, targetProp) {\r\n    var desc = getOwnPropertyDescriptor(obj, prop);\r\n    if (!desc ? prop in obj : desc.get || desc.set) {\r\n        throw new Error('Cannot create alias property');\r\n    }\r\n    targetProp = targetProp || prop;\r\n    defineGetterProperty(obj, prop, function () {\r\n        return target[targetProp];\r\n    }, function (value) {\r\n        target[targetProp] = value;\r\n    });\r\n    var state = getObservableState(obj);\r\n    state.alias[prop] = getObservableState(target).alias[targetProp] || [target, targetProp];\r\n}\r\n\r\nfunction defineObservableProperty(obj, prop, initialValue, callback) {\r\n    var state = getObservableState(obj);\r\n    var alias = state.alias[prop];\r\n    if (alias) {\r\n        return defineObservableProperty(alias[0], alias[1], initialValue, callback);\r\n    }\r\n    if (!(prop in state.values)) {\r\n        var desc = getOwnPropertyDescriptor(obj, prop);\r\n        if (!desc ? prop in obj : desc.get || desc.set) {\r\n            throw new Error('Only own data property can be observed');\r\n        }\r\n        var setter = function (value) {\r\n            var state = getObservableState(this);\r\n            var oldValue = state.values[prop];\r\n            if (isFunction(callback)) {\r\n                value = callback.call(this, value, oldValue);\r\n            }\r\n            if (value !== oldValue) {\r\n                if (!(prop in state.oldValues)) {\r\n                    state.oldValues[prop] = oldValue;\r\n                }\r\n                state.values[prop] = value;\r\n                state.newValues[prop] = value;\r\n                if (!state.sync) {\r\n                    setImmediateOnce(state.handleChanges);\r\n                } else if (!state.lock) {\r\n                    state.handleChanges();\r\n                }\r\n            }\r\n        };\r\n        state.values[prop] = prop in obj ? obj[prop] : initialValue;\r\n        defineGetterProperty(obj, prop, function () {\r\n            var state = getObservableState(this);\r\n            return state.values[prop];\r\n        }, callback === true ? undefined : setter);\r\n        return setter.bind(obj);\r\n    }\r\n}\r\n\r\nfunction watch(obj, prop, handler, fireInit) {\r\n    if (prop === true) {\r\n        var state = getObservableState(obj, true);\r\n        return state.handleChanges;\r\n    }\r\n    if (isFunction(prop)) {\r\n        getObservableState(obj).handlers.push(prop);\r\n    } else {\r\n        defineObservableProperty(obj, prop);\r\n        if (isFunction(handler)) {\r\n            var alias = getObservableState(obj).alias[prop] || [obj, prop];\r\n            var handlers = getObservableState(alias[0]).handlers;\r\n            handlers.push(function (e) {\r\n                if (alias[1] in e.newValues) {\r\n                    handler.call(obj, e.newValues[alias[1]], e.oldValues[alias[1]], prop, obj);\r\n                }\r\n            });\r\n            if (fireInit) {\r\n                handler.call(obj, obj[prop], null, prop, obj);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction watchOnce(obj, prop, handler) {\r\n    defineObservableProperty(obj, prop);\r\n    return new Promise(function (resolve) {\r\n        var alias = getObservableState(obj).alias[prop] || [obj, prop];\r\n        var handlers = getObservableState(alias[0]).handlers;\r\n        handlers.push(function fn(e) {\r\n            if (alias[1] in e.newValues) {\r\n                var value = e.newValues[alias[1]];\r\n                var returnValue;\r\n                handlers.splice(handlers.indexOf(fn), 1);\r\n                if (isFunction(handler)) {\r\n                    returnValue = handler(value);\r\n                }\r\n                resolve(returnValue === undefined ? value : returnValue);\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nfunction watchable(obj) {\r\n    obj = obj || {};\r\n    define(obj, {\r\n        watch: function (prop, handler, fireInit) {\r\n            watch(this, prop, handler, fireInit);\r\n        },\r\n        watchOnce: function (prop, handler) {\r\n            return watchOnce(this, prop, handler);\r\n        }\r\n    });\r\n    return obj;\r\n}\r\n\r\nexport {\r\n    // miscellanous\r\n    noop,\r\n    either,\r\n    isArray,\r\n    isFunction,\r\n    isThenable,\r\n    isPlainObject,\r\n    isArrayLike,\r\n    makeArray,\r\n    extend,\r\n    each,\r\n    map,\r\n    grep,\r\n    splice,\r\n    any,\r\n    single,\r\n    kv,\r\n    mapGet,\r\n    mapRemove,\r\n    equal,\r\n    createPrivateStore,\r\n    setTimeoutOnce,\r\n    setImmediate,\r\n    setImmediateOnce,\r\n\r\n    // throw\r\n    throwNotFunction,\r\n\r\n    // property and prototype related\r\n    keys,\r\n    values,\r\n    hasOwnProperty,\r\n    getOwnPropertyDescriptors,\r\n    define,\r\n    definePrototype,\r\n    defineOwnProperty,\r\n    defineGetterProperty,\r\n    defineHiddenProperty,\r\n    defineAliasProperty,\r\n    defineObservableProperty,\r\n    watch,\r\n    watchOnce,\r\n    watchable,\r\n    inherit,\r\n    deepFreeze,\r\n\r\n    // string related\r\n    iequal,\r\n    randomId,\r\n    repeat,\r\n    camel,\r\n    hyphenate,\r\n    ucfirst,\r\n    lcfirst,\r\n    trim,\r\n    matchWord,\r\n    htmlDecode,\r\n\r\n    // promise\r\n    resolve,\r\n    reject,\r\n    always,\r\n    resolveAll,\r\n    catchAsync,\r\n    setPromiseTimeout\r\n};\r\n","import { any, isFunction, isPlainObject, each, map, definePrototype, kv, noop, always, matchWord } from \"./util.js\";\r\nimport { $ } from \"./shim.js\";\r\n\r\nconst root = document.documentElement;\r\nconst selection = window.getSelection();\r\n// @ts-ignore: non-standard member\r\nconst elementsFromPoint = document.msElementsFromPoint || document.elementsFromPoint;\r\nconst compareDocumentPositionImpl = document.compareDocumentPosition;\r\nconst compareBoundaryPointsImpl = Range.prototype.compareBoundaryPoints;\r\nconst OFFSET_ZERO = Object.freeze({\r\n    x: 0,\r\n    y: 0\r\n});\r\n\r\nvar originDiv;\r\nvar scrollbarWidth;\r\n\r\n/* --------------------------------------\r\n * Custom class\r\n * -------------------------------------- */\r\n\r\nfunction Rect(l, t, r, b) {\r\n    var self = this;\r\n    self.left = l;\r\n    self.top = t;\r\n    self.right = r;\r\n    self.bottom = b;\r\n}\r\n\r\ndefinePrototype(Rect, {\r\n    get width() {\r\n        return this.right - this.left;\r\n    },\r\n    get height() {\r\n        return this.bottom - this.top;\r\n    },\r\n    get centerX() {\r\n        return (this.left + this.right) / 2;\r\n    },\r\n    get centerY() {\r\n        return (this.top + this.bottom) / 2;\r\n    },\r\n    collapse: function (side, offset) {\r\n        var rect = this;\r\n        var pos = rect[side] + (offset || 0);\r\n        return side === 'left' || side === 'right' ? toPlainRect(pos, rect.top, pos, rect.bottom) : toPlainRect(rect.left, pos, rect.right, pos);\r\n    },\r\n    translate: function (x, y) {\r\n        var self = this;\r\n        return toPlainRect(self.left + x, self.top + y, self.right + x, self.bottom + y);\r\n    },\r\n    expand: function (l, t, r, b) {\r\n        var self = this;\r\n        switch (arguments.length) {\r\n            case 1:\r\n                t = l;\r\n            case 2:\r\n                r = l;\r\n            case 3:\r\n                b = t;\r\n        }\r\n        var w = self.width;\r\n        var h = self.height;\r\n        var dx = l + r + w;\r\n        var dy = t + b + h;\r\n        if (dx < 0) {\r\n            l -= (dx * l / (l + r)) | 0;\r\n            // @ts-ignore: type inference issue\r\n            r = -(l + w);\r\n        }\r\n        if (dy < 0) {\r\n            t -= (dy * t / (t + b)) | 0;\r\n            // @ts-ignore: type inference issue\r\n            b = -(t + h);\r\n        }\r\n        // @ts-ignore: type inference issue\r\n        return toPlainRect(self.left - l, self.top - t, self.right + r, self.bottom + b);\r\n    }\r\n});\r\n\r\n\r\n/* --------------------------------------\r\n * General helper\r\n * -------------------------------------- */\r\n\r\nfunction tagName(element) {\r\n    return element && element.tagName && element.tagName.toLowerCase();\r\n}\r\n\r\nfunction is(element, selector) {\r\n    if (!element || !selector) {\r\n        return false;\r\n    }\r\n    // constructors of native DOM objects in Safari refuse to be functions\r\n    // use a fairly accurate but fast checking instead of isFunction\r\n    if (selector.prototype) {\r\n        return element instanceof selector && element;\r\n    }\r\n    if (selector.toFixed) {\r\n        var nodeType = element.nodeType;\r\n        return (nodeType & selector) === nodeType && element;\r\n    }\r\n    return (selector === '*' || tagName(element) === selector || $(element).is(selector)) && element;\r\n}\r\n\r\nfunction sameElementSpec(a, b) {\r\n    if (tagName(a) !== tagName(b)) {\r\n        return false;\r\n    }\r\n    var thisAttr = a.attributes;\r\n    var prevAttr = b.attributes;\r\n    return thisAttr.length === prevAttr.length && !any(thisAttr, function (v) {\r\n        return !prevAttr[v.nodeName] || v.value !== prevAttr[v.nodeName].value;\r\n    });\r\n}\r\n\r\nfunction comparePosition(a, b, strict) {\r\n    if (a === b) {\r\n        return 0;\r\n    }\r\n    var v = a && b && compareDocumentPositionImpl.call(a.element || a, b.element || b);\r\n    if (v & 2) {\r\n        return (strict && v & 8) || (v & 1) ? NaN : 1;\r\n    }\r\n    if (v & 4) {\r\n        return (strict && v & 16) || (v & 1) ? NaN : -1;\r\n    }\r\n    return NaN;\r\n}\r\n\r\nfunction connected(a, b) {\r\n    return a && b && !(compareDocumentPositionImpl.call(a.commonAncestorContainer || a, b.commonAncestorContainer || b) & 1);\r\n}\r\n\r\nfunction containsOrEquals(container, contained) {\r\n    container = (container || '').element || container;\r\n    contained = (contained || '').element || contained;\r\n    return container === contained || $.contains(container, contained);\r\n}\r\n\r\nfunction isVisible(element) {\r\n    if (!connected(root, element)) {\r\n        return false;\r\n    }\r\n    var rect = getRect(element);\r\n    if (!rect.top && !rect.left && !rect.width && !rect.height) {\r\n        for (var cur = element; cur; cur = cur.parentNode) {\r\n            if (getComputedStyle(cur).display === 'none') {\r\n                return false;\r\n            }\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction acceptNode(iterator, node) {\r\n    node = node || iterator.currentNode;\r\n    if (!node || !(iterator.whatToShow & (is(node, Node) ? (1 << (node.nodeType - 1)) : node.nodeType))) {\r\n        return 3;\r\n    }\r\n    return !iterator.filter ? 1 : (iterator.filter.acceptNode || iterator.filter).call(iterator.filter, node);\r\n}\r\n\r\nfunction iterateNode(iterator, callback, from, until) {\r\n    var i = 0;\r\n    iterator.currentNode = from = from || iterator.currentNode;\r\n    callback = callback || noop;\r\n    switch (acceptNode(iterator)) {\r\n        case 2:\r\n            return;\r\n        case 1:\r\n            callback(from, i++);\r\n    }\r\n    for (var cur; (cur = iterator.nextNode()) && (!until || (isFunction(until) ? until(cur) : cur !== until || void callback(cur, i++))); callback(cur, i++));\r\n}\r\n\r\nfunction iterateNodeToArray(iterator, callback, from, until) {\r\n    var result = [];\r\n    iterateNode(iterator, function (v) {\r\n        result[result.length] = v;\r\n    }, from, until);\r\n    return callback ? map(result, callback) : result;\r\n}\r\n\r\n\r\n/* --------------------------------------\r\n * Advanced traversal\r\n * -------------------------------------- */\r\n\r\nfunction getCommonAncestor(a, b) {\r\n    for (b = b || a; a && a !== b && compareDocumentPositionImpl.call(a, b) !== 20; a = a.parentNode);\r\n    return a;\r\n}\r\n\r\nfunction parentsAndSelf(element) {\r\n    if (element === window) {\r\n        return [];\r\n    }\r\n    for (var arr = []; element && element !== document && arr.push(element); element = element.parentNode || element.parent);\r\n    return arr;\r\n}\r\n\r\nfunction selectIncludeSelf(selector, container) {\r\n    container = container || root;\r\n    var matched = $.uniqueSort($(container).find(selector).add($(container).filter(selector)).get());\r\n    if (matched[0] || container === root) {\r\n        return matched;\r\n    }\r\n    return $(container).find($(selector)).get();\r\n}\r\n\r\nfunction selectClosestRelative(selector, container) {\r\n    container = container || root;\r\n    var element = $(selector, container)[0];\r\n    if (!element) {\r\n        var $matched = $(selector);\r\n        for (; container !== root && !element; container = container.parentNode) {\r\n            element = $matched.get().filter(function (v) {\r\n                return containsOrEquals(container, v);\r\n            })[0];\r\n        }\r\n    }\r\n    return element;\r\n}\r\n\r\n\r\n/* --------------------------------------\r\n * Create\r\n * -------------------------------------- */\r\n\r\nfunction createDocumentFragment(node) {\r\n    return is(node, DocumentFragment) || $(document.createDocumentFragment()).append(node)[0];\r\n}\r\n\r\nfunction createTextNode(text) {\r\n    return document.createTextNode(text || '\\u200b');\r\n}\r\n\r\nfunction createElement(name) {\r\n    return document.createElement(name);\r\n}\r\n\r\nfunction createNodeIterator(root, whatToShow, filter) {\r\n    // @ts-ignore: assume filter is of correct signature\r\n    return document.createNodeIterator(root, whatToShow, isFunction(filter) || null, false);\r\n}\r\n\r\nfunction createTreeWalker(root, whatToShow, filter) {\r\n    // @ts-ignore: assume filter is of correct signature\r\n    return document.createTreeWalker(root, whatToShow, isFunction(filter) || null, false);\r\n}\r\n\r\n\r\n/* --------------------------------------\r\n * Events\r\n * -------------------------------------- */\r\n\r\nfunction addOrRemoveEventListener(method, element, event, listener, useCapture) {\r\n    if (isPlainObject(event)) {\r\n        each(event, function (i, v) {\r\n            element[method](i, v, listener);\r\n        });\r\n    } else if (typeof event === 'string') {\r\n        each(event.split(' '), function (i, v) {\r\n            element[method](v, listener, useCapture);\r\n        });\r\n    }\r\n}\r\n\r\nfunction bind(element, event, listener, useCapture) {\r\n    addOrRemoveEventListener('addEventListener', element, event, listener, useCapture);\r\n    return function () {\r\n        unbind(element, event, listener);\r\n    };\r\n}\r\n\r\nfunction unbind(element, event, listener) {\r\n    addOrRemoveEventListener('removeEventListener', element, event, listener);\r\n}\r\n\r\nfunction bindUntil(promise, element, event, listener, useCapture) {\r\n    always(promise, bind(element, event, listener, useCapture));\r\n}\r\n\r\nfunction dispatchDOMMouseEvent(eventName, point, e) {\r\n    if (typeof eventName !== 'string') {\r\n        e = eventName;\r\n        eventName = e.type;\r\n    }\r\n    var target = point ? elementFromPoint(point.clientX, point.clientY) || root : e.target;\r\n    var event = document.createEvent('MouseEvent');\r\n    point = point || e;\r\n    event.initMouseEvent(eventName, e.bubbles, e.cancelable, e.view, e.detail, point.screenX, point.screenY, point.clientX, point.clientY, e.ctrlKey, e.altKey, e.shiftKey, e.metaKey, e.button, e.relatedTarget);\r\n    return target.dispatchEvent(event);\r\n}\r\n\r\n\r\n/* --------------------------------------\r\n * DOM manip\r\n * -------------------------------------- */\r\n\r\nfunction removeNode(node) {\r\n    if (node.parentNode) {\r\n        node.parentNode.removeChild(node);\r\n    }\r\n}\r\n\r\nfunction getClass(element, className) {\r\n    var re = new RegExp('(?:^|\\\\s+)' + className + '(?:-(\\\\S+)|\\\\b)', 'ig');\r\n    var t = [false];\r\n    (element.className || '').replace(re, function (v, a) {\r\n        t[a ? t.length : 0] = a || true;\r\n    });\r\n    return t[1] ? t.slice(1) : t[0];\r\n}\r\n\r\nfunction setClass(element, className, values) {\r\n    var value = element.className || '';\r\n    each(isPlainObject(className) || kv(className, values), function (i, v) {\r\n        var re = new RegExp('(^|\\\\s)\\\\s*' + i + '(?:-(\\\\S+)|\\\\b)|\\\\s*$', 'ig');\r\n        var replaced = 0;\r\n        if (isPlainObject(v)) {\r\n            v = map(v, function (v, i) {\r\n                return v ? i : null;\r\n            });\r\n        }\r\n        value = value.replace(re, function () {\r\n            return replaced++ || !v || v.length === 0 ? '' : (' ' + i + (v[0] ? [''].concat(v).join(' ' + i + '-') : ''));\r\n        });\r\n    });\r\n    element.className = value;\r\n}\r\n\r\nfunction getScrollOffset(winOrElm) {\r\n    return {\r\n        x: winOrElm.pageXOffset || winOrElm.scrollLeft || 0,\r\n        y: winOrElm.pageYOffset || winOrElm.scrollTop || 0\r\n    };\r\n}\r\n\r\nfunction getScrollParent(element) {\r\n    for (var s; element !== root && (s = getComputedStyle(element)) && s.overflow === 'visible' && matchWord(s.position, 'static relative'); element = element.parentNode);\r\n    return element;\r\n}\r\n\r\nfunction scrollBy(element, x, y) {\r\n    var winOrElm = element === root || element === document.body ? window : element;\r\n    var orig = getScrollOffset(winOrElm);\r\n    if (winOrElm.scrollBy) {\r\n        winOrElm.scrollBy(x, y);\r\n    } else {\r\n        winOrElm.scrollLeft = orig.x + x;\r\n        winOrElm.scrollTop = orig.y + y;\r\n    }\r\n    var cur = getScrollOffset(winOrElm);\r\n    return {\r\n        x: cur.x - orig.x,\r\n        y: cur.y - orig.y\r\n    };\r\n}\r\n\r\nfunction getContentRect(element) {\r\n    if (scrollbarWidth === undefined) {\r\n        // detect native scrollbar size\r\n        // height being picked because scrollbar may not be shown if container is too short\r\n        var dummy = $('<div style=\"overflow:scroll;height:80px\"><div style=\"height:100px\"></div></div>').appendTo(document.body)[0];\r\n        scrollbarWidth = getRect(dummy).width - getRect(dummy.children[0]).width;\r\n        removeNode(dummy);\r\n    }\r\n    var style = getComputedStyle(element);\r\n    var hasOverflowX = element.offsetWidth < element.scrollWidth;\r\n    var hasOverflowY = element.offsetHeight < element.scrollHeight;\r\n    var parentRect = getRect(element === document.body ? root : element);\r\n    if ((style.overflow !== 'visible' || element === document.body) && (hasOverflowX || hasOverflowY)) {\r\n        if (style.overflowY === 'scroll' || ((style.overflowY !== 'hidden' || element === document.body) && hasOverflowY)) {\r\n            parentRect.right -= scrollbarWidth;\r\n        }\r\n        if (style.overflowX === 'scroll' || ((style.overflowX !== 'hidden' || element === document.body) && hasOverflowX)) {\r\n            parentRect.bottom -= scrollbarWidth;\r\n        }\r\n    }\r\n    return parentRect;\r\n}\r\n\r\nfunction scrollIntoView(element, rect) {\r\n    if (!rect || rect.top === undefined) {\r\n        rect = getRect(element, rect);\r\n    }\r\n    var parent = getScrollParent(element);\r\n    var parentRect = getContentRect(parent);\r\n    var deltaX = Math.max(0, rect.right - parentRect.right) || Math.min(rect.left - parentRect.left, 0);\r\n    var deltaY = Math.max(0, rect.bottom - parentRect.bottom) || Math.min(rect.top - parentRect.top, 0);\r\n    var result = (deltaX || deltaY) && scrollBy(parent, deltaX, deltaY) || OFFSET_ZERO;\r\n    if (parent !== root) {\r\n        var parentResult = scrollIntoView(parent.parentNode, rect.translate(result.x, result.y));\r\n        if (parentResult) {\r\n            result = {\r\n                x: result.x + parentResult.x,\r\n                y: result.y + parentResult.y\r\n            };\r\n        }\r\n    }\r\n    return (result.x || result.y) ? result : false;\r\n}\r\n\r\n\r\n/* --------------------------------------\r\n * Range and rect\r\n * -------------------------------------- */\r\n\r\nfunction createRange(startNode, startOffset, endNode, endOffset) {\r\n    if (startNode && isFunction(startNode.getRange)) {\r\n        return startNode.getRange();\r\n    }\r\n    var range;\r\n    if (is(startNode, Node)) {\r\n        range = document.createRange();\r\n        if (+startOffset !== startOffset) {\r\n            range[(startOffset === 'contents' || !startNode.parentNode) ? 'selectNodeContents' : 'selectNode'](startNode);\r\n            if (typeof startOffset === 'boolean') {\r\n                range.collapse(startOffset);\r\n            }\r\n        } else {\r\n            range.setStart(startNode, getOffset(startNode, startOffset));\r\n        }\r\n        if (is(endNode, Node) && connected(startNode, endNode)) {\r\n            range.setEnd(endNode, getOffset(endNode, endOffset));\r\n        }\r\n    } else if (is(startNode, Range)) {\r\n        range = startNode.cloneRange();\r\n        if (!range.collapsed && typeof startOffset === 'boolean') {\r\n            range.collapse(startOffset);\r\n        }\r\n    }\r\n    if (is(startOffset, Range) && connected(range, startOffset)) {\r\n        var inverse = range.collapsed && startOffset.collapsed ? -1 : 1;\r\n        if (compareBoundaryPointsImpl.call(range, 0, startOffset) * inverse < 0) {\r\n            range.setStart(startOffset.startContainer, startOffset.startOffset);\r\n        }\r\n        if (compareBoundaryPointsImpl.call(range, 2, startOffset) * inverse > 0) {\r\n            range.setEnd(startOffset.endContainer, startOffset.endOffset);\r\n        }\r\n    }\r\n    return range;\r\n}\r\n\r\nfunction rangeIntersects(a, b) {\r\n    a = is(a, Range) || createRange(a);\r\n    b = is(b, Range) || createRange(b);\r\n    return connected(a, b) && compareBoundaryPointsImpl.call(a, 3, b) <= 0 && compareBoundaryPointsImpl.call(a, 1, b) >= 0;\r\n}\r\n\r\nfunction rangeCovers(a, b) {\r\n    a = is(a, Range) || createRange(a);\r\n    b = is(b, Range) || createRange(b);\r\n    return connected(a, b) && compareBoundaryPointsImpl.call(a, 0, b) <= 0 && compareBoundaryPointsImpl.call(a, 2, b) >= 0;\r\n}\r\n\r\nfunction rangeEquals(a, b) {\r\n    a = is(a, Range) || createRange(a);\r\n    b = is(b, Range) || createRange(b);\r\n    return connected(a, b) && compareBoundaryPointsImpl.call(a, 0, b) === 0 && compareBoundaryPointsImpl.call(a, 2, b) === 0;\r\n}\r\n\r\nfunction compareRangePosition(a, b, strict) {\r\n    a = is(a, Range) || createRange(a);\r\n    b = is(b, Range) || createRange(b);\r\n    var value = !connected(a, b) ? NaN : compareBoundaryPointsImpl.call(a, 0, b) + compareBoundaryPointsImpl.call(a, 2, b);\r\n    return (strict && ((value !== 0 && rangeIntersects(a, b)) || (value === 0 && !rangeEquals(a, b)))) ? NaN : value && value / Math.abs(value);\r\n}\r\n\r\nfunction makeSelection(b, e) {\r\n    if (!selection) {\r\n        return;\r\n    }\r\n    // for newer browsers that supports setBaseAndExtent\r\n    // avoid undesirable effects when direction of editor's selection direction does not match native one\r\n    if (selection.setBaseAndExtent && is(e, Range)) {\r\n        selection.setBaseAndExtent(b.startContainer, b.startOffset, e.startContainer, e.startOffset);\r\n        return;\r\n    }\r\n\r\n    var range = createRange(b, e);\r\n    try {\r\n        selection.removeAllRanges();\r\n    } catch (e) {\r\n        // IE fails to clear ranges by removeAllRanges() in occasions mentioned in\r\n        // http://stackoverflow.com/questions/22914075\r\n        // @ts-ignore: non-standard member\r\n        var r = document.body.createTextRange();\r\n        r.collapse();\r\n        r.select();\r\n        selection.removeAllRanges();\r\n    }\r\n    try {\r\n        selection.addRange(range);\r\n    } catch (e) {\r\n        // IE may throws unspecified error even though the selection is successfully moved to the given range\r\n        // if the range is not successfully selected retry after selecting other range\r\n        if (!selection.rangeCount) {\r\n            selection.addRange(createRange(document.body));\r\n            selection.removeAllRanges();\r\n            selection.addRange(range);\r\n        }\r\n    }\r\n}\r\n\r\nfunction getRect(elm, includeMargin) {\r\n    var rect;\r\n    elm = elm || root;\r\n    if (elm.getRect) {\r\n        return elm.getRect();\r\n    }\r\n    elm = elm.element || elm;\r\n    if (elm === root || elm === window) {\r\n        var div = originDiv || (originDiv = $('<div style=\"position:fixed; top:0; left:0;\">')[0]);\r\n        if (!containsOrEquals(document.body, div)) {\r\n            document.body.appendChild(div);\r\n        }\r\n        // origin used by CSS, DOMRect and properties like clientX/Y may move away from the top-left corner of the window\r\n        // when virtual keyboard is shown on mobile devices\r\n        var o = getRect(div);\r\n        rect = toPlainRect(0, 0, root.offsetWidth, root.offsetHeight).translate(o.left, o.top);\r\n    } else if (!containsOrEquals(root, elm)) {\r\n        // IE10 throws Unspecified Error for detached elements\r\n        rect = toPlainRect(0, 0, 0, 0);\r\n    } else {\r\n        rect = toPlainRect(elm.getBoundingClientRect());\r\n        if (includeMargin === true) {\r\n            var style = getComputedStyle(elm);\r\n            var marginTop = Math.max(0, parseFloat(style.marginTop));\r\n            var marginLeft = Math.max(0, parseFloat(style.marginLeft));\r\n            var marginRight = Math.max(0, parseFloat(style.marginRight));\r\n            var marginBottom = Math.max(0, parseFloat(style.marginBottom));\r\n            rect = rect.expand(marginLeft, marginTop, marginRight, marginBottom);\r\n        } else if (includeMargin) {\r\n            rect = rect.expand(includeMargin);\r\n        }\r\n    }\r\n    return rect;\r\n}\r\n\r\nfunction getOffset(node, offset) {\r\n    var len = node.length || node.childNodes.length;\r\n    return 1 / offset < 0 ? Math.max(0, len + offset) : Math.min(len, offset);\r\n}\r\n\r\nfunction getRects(range) {\r\n    return map((is(range, Range) || createRange(range, 'contents')).getClientRects(), toPlainRect);\r\n}\r\n\r\nfunction toPlainRect(l, t, r, b) {\r\n    function clip(v) {\r\n        // IE provides precision up to 0.05 but with floating point errors that hinder comparisons\r\n        return Math.round(v * 1000) / 1000;\r\n    }\r\n    if (l.top !== undefined) {\r\n        return new Rect(clip(l.left), clip(l.top), clip(l.right), clip(l.bottom));\r\n    }\r\n    if (r === undefined) {\r\n        return new Rect(l, t, l, t);\r\n    }\r\n    return new Rect(l, t, r, b);\r\n}\r\n\r\nfunction rectEquals(a, b) {\r\n    function check(prop) {\r\n        return Math.abs(a[prop] - b[prop]) < 1;\r\n    }\r\n    return check('left') && check('top') && check('bottom') && check('right');\r\n}\r\n\r\nfunction rectCovers(a, b) {\r\n    return b.left >= a.left && b.right <= a.right && b.top >= a.top && b.bottom <= a.bottom;\r\n}\r\n\r\nfunction rectIntersects(a, b) {\r\n    return !(b.right < a.left || b.left > a.right) && !(b.bottom < a.top || b.top > a.bottom);\r\n}\r\n\r\nfunction pointInRect(x, y, rect, within) {\r\n    within = within || 0;\r\n    return rect.width && rect.height && x - rect.left >= -within && x - rect.right <= within && y - rect.top >= -within && y - rect.bottom <= within;\r\n}\r\n\r\nfunction mergeRect(a, b) {\r\n    return toPlainRect(Math.min(a.left, b.left), Math.min(a.top, b.top), Math.max(a.right, b.right), Math.max(a.bottom, b.bottom));\r\n}\r\n\r\nfunction elementFromPoint(x, y, container) {\r\n    container = container || document.body;\r\n    if (elementsFromPoint) {\r\n        return any(elementsFromPoint.call(document, x, y), function (v) {\r\n            return containsOrEquals(container, v) && getComputedStyle(v).pointerEvents !== 'none';\r\n        }) || null;\r\n    }\r\n    var element = document.elementFromPoint(x, y);\r\n    if (!containsOrEquals(container, element) && pointInRect(x, y, getRect(container))) {\r\n        var tmp = [];\r\n        try {\r\n            while (element && comparePosition(container, element, true)) {\r\n                var target = $(element).parentsUntil(getCommonAncestor(container, element)).slice(-1)[0] || element;\r\n                if (target === tmp[tmp.length - 1]) {\r\n                    return null;\r\n                }\r\n                // @ts-ignore: assume we are working with HTMLElement\r\n                target.style.pointerEvents = 'none';\r\n                tmp[tmp.length] = target;\r\n                element = document.elementFromPoint(x, y);\r\n            }\r\n        } finally {\r\n            $(tmp).css('pointer-events', '');\r\n        }\r\n    }\r\n    return containsOrEquals(container, element) ? element : null;\r\n}\r\n\r\n\r\nexport {\r\n    tagName,\r\n    is,\r\n    isVisible,\r\n    sameElementSpec,\r\n    comparePosition,\r\n    connected,\r\n    containsOrEquals,\r\n    iterateNode,\r\n    iterateNodeToArray,\r\n\r\n    getCommonAncestor,\r\n    parentsAndSelf,\r\n    selectIncludeSelf,\r\n    selectClosestRelative,\r\n\r\n    createDocumentFragment,\r\n    createTextNode,\r\n    createElement,\r\n    createNodeIterator,\r\n    createTreeWalker,\r\n\r\n    bind,\r\n    bindUntil,\r\n    dispatchDOMMouseEvent,\r\n\r\n    removeNode,\r\n    getClass,\r\n    setClass,\r\n    getScrollOffset,\r\n    getScrollParent,\r\n    getContentRect,\r\n    scrollBy,\r\n    scrollIntoView,\r\n\r\n    createRange,\r\n    rangeIntersects,\r\n    rangeEquals,\r\n    rangeCovers,\r\n    compareRangePosition,\r\n    makeSelection,\r\n\r\n    getRect,\r\n    getRects,\r\n    toPlainRect,\r\n    rectEquals,\r\n    rectCovers,\r\n    rectIntersects,\r\n    pointInRect,\r\n    mergeRect,\r\n    elementFromPoint\r\n};\r\n","import { Map, Promise, $ } from \"./shim.js\";\r\nimport { getClass, setClass, iterateNode, createNodeIterator, isVisible, bind } from \"./domUtil.js\";\r\nimport { reject, noop, resolve, each, matchWord, keys } from \"./util.js\";\r\n\r\nfunction parseCSS(value) {\r\n    var styles = {};\r\n    var div = document.createElement('div');\r\n    div.setAttribute('style', value);\r\n    each(div.style, function (i, v) {\r\n        styles[v] = div.style[v];\r\n    });\r\n    return styles;\r\n}\r\n\r\nfunction isCssUrlValue(value) {\r\n    return value && value !== 'none' && /url\\((?:'(.+)'|\"(.+)\"|([^)]+))\\)/.test(value) && (RegExp.$1 || RegExp.$2 || RegExp.$3);\r\n}\r\n\r\nfunction styleToJSON(style) {\r\n    var t = {};\r\n    each(style, function (i, v) {\r\n        t[v] = style[v];\r\n    });\r\n    return t;\r\n}\r\n\r\nfunction animatableValue(v, allowNumber) {\r\n    return /\\b(?:[+-]?(\\d+(?:\\.\\d+)?)(px|%)?|#[0-9a-f]{3,}|(rgba?|hsla?|matrix|calc)\\(.+\\))\\b/.test(v) && (allowNumber || !RegExp.$1 || RegExp.$2);\r\n}\r\n\r\nfunction removeVendorPrefix(name) {\r\n    return name.replace(/^-(webkit|moz|ms|o)-/, '');\r\n}\r\n\r\nfunction runCSSTransition(element, className, callback) {\r\n    if (getClass(element, className)) {\r\n        return reject();\r\n    }\r\n    callback = callback || noop;\r\n    if (callback === true) {\r\n        callback = setClass.bind(null, element, className, false);\r\n    }\r\n    setClass(element, className, true);\r\n    var arr = [];\r\n    var map1 = new Map();\r\n    var test = function (element, pseudoElement) {\r\n        var style = getComputedStyle(element, pseudoElement);\r\n        if (style.transitionDuration !== '0s' || style.animationName != 'none') {\r\n            var key = { element: element, pseudoElement: pseudoElement };\r\n            map1.set(key, style.transitionProperty.split(/,\\s*/));\r\n            arr.push(key);\r\n        }\r\n    };\r\n    iterateNode(createNodeIterator(element, 1, function (v) {\r\n        if (!isVisible(v)) {\r\n            return 2;\r\n        }\r\n        test(v, null);\r\n        test(v, '::before');\r\n        test(v, '::after');\r\n    }));\r\n    if (!arr[0]) {\r\n        callback();\r\n        return resolve();\r\n    }\r\n\r\n    var targets = arr.map(function (v) {\r\n        return v.element;\r\n    });\r\n    setClass(element, className, false);\r\n    $(targets).css('transition', 'none');\r\n    setClass(element, className, true);\r\n    var newStyle = arr.map(function (v) {\r\n        return styleToJSON(getComputedStyle(v.element, v.pseudoElement));\r\n    });\r\n    setClass(element, className, false);\r\n\r\n    var appendPseudoToAnim = window.AnimationEvent && 'pseudoElement' in AnimationEvent.prototype;\r\n    var map = new Map();\r\n    each(arr, function (i, v) {\r\n        var pseudoElement = v.pseudoElement;\r\n        var curStyle = getComputedStyle(v.element, pseudoElement);\r\n        var transitionProperties = map1.get(v);\r\n        var dict = {};\r\n        each(curStyle, function (j, v) {\r\n            var curValue = curStyle[v];\r\n            var newValue = newStyle[i][v];\r\n            if (curValue === 'matrix(1, 0, 0, 1, 0, 0)') {\r\n                curValue = 'none';\r\n            }\r\n            if (newValue === 'matrix(1, 0, 0, 1, 0, 0)') {\r\n                newValue = 'none';\r\n            }\r\n            if (curValue !== newValue) {\r\n                var prop = removeVendorPrefix(v);\r\n                var allowNumber = matchWord(v, 'opacity line-height');\r\n                if (prop === 'animation-name') {\r\n                    var prevAnim = curValue.replace(/,/g, '');\r\n                    each(newValue.split(/,\\s*/), function (i, v) {\r\n                        if (v !== 'none' && !matchWord(prevAnim, v)) {\r\n                            dict['@' + v + ((appendPseudoToAnim && pseudoElement) || '')] = true;\r\n                        }\r\n                    });\r\n                } else if (prop === 'transform' || (animatableValue(curValue, allowNumber) && animatableValue(newValue, allowNumber) && !/^scroll-limit/.test(prop))) {\r\n                    if (transitionProperties[0] === 'all' || transitionProperties.indexOf(v + (pseudoElement || '')) >= 0) {\r\n                        dict[prop + (pseudoElement || '')] = true;\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        if (keys(dict)[0]) {\r\n            map.set(v.element, dict);\r\n        }\r\n    });\r\n    $(targets).css('transition', '');\r\n    setClass(element, className, true);\r\n    if (!map.size) {\r\n        callback();\r\n        return resolve();\r\n    }\r\n\r\n    return new Promise(function (resolve, reject) {\r\n        var unbind = bind(element, 'animationend transitionend', function (e) {\r\n            var dict = map.get(e.target) || {};\r\n            // @ts-ignore: mixed type of Event\r\n            delete dict[(e.propertyName ? removeVendorPrefix(e.propertyName) : '@' + e.animationName) + (e.pseudoElement || '')];\r\n            if (!keys(dict)[0] && map.delete(e.target) && !map.size) {\r\n                unbind();\r\n                if (getClass(element, className)) {\r\n                    callback();\r\n                    resolve(element);\r\n                } else {\r\n                    reject(element);\r\n                }\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nexport {\r\n    parseCSS,\r\n    isCssUrlValue,\r\n    runCSSTransition\r\n\r\n    // getZIndex: getZIndex,\r\n    // getZIndexOver: getZIndexOver,\r\n    // setZIndexOver: setZIndexOver,\r\n    // cssFromPoint: cssFromPoint,\r\n    // cssFromRect: cssFromRect,\r\n    // position: position,\r\n    // snap:  (element, to, dir)\r\n    // unsnap:  (element)\r\n    // drag:  drag(event, within, callback)\r\n    // scrollIntoView:  scrollIntoView(element, rect)\r\n};\r\n","import { Map, WeakMap, Promise } from \"./shim.js\";\r\nimport { any, createPrivateStore, definePrototype, extend, makeArray, mapRemove, reject, resolve } from \"./util.js\";\r\nimport { parentsAndSelf } from \"./domUtil.js\";\r\nimport { emitDOMEvent } from \"./events.js\";\r\nimport { afterDetached } from \"./observe.js\";\r\n\r\nconst lockedElements = new WeakMap();\r\nconst handledErrors = new WeakMap();\r\nconst _ = createPrivateStore();\r\n\r\nfunction retryable(fn, done) {\r\n    var promise;\r\n    return function () {\r\n        return promise || (promise = resolve(fn()).then(done, function () {\r\n            // user has rejected the cancellation\r\n            // remove the promise object so that user will be prompted again\r\n            promise = null;\r\n            return reject('user_cancelled');\r\n        }));\r\n    };\r\n}\r\n\r\nfunction lock(element, promise, oncancel) {\r\n    var lock = lockedElements.get(element) || new DOMLock(element);\r\n    return promise ? lock.wait(promise, oncancel) : resolve();\r\n}\r\n\r\nfunction locked(element, parents) {\r\n    return !!any(parents ? parentsAndSelf(element) : [element], function (v) {\r\n        return (lockedElements.get(v) || '').locked;\r\n    });\r\n}\r\n\r\nfunction cancelLock(element, force) {\r\n    var lock = lockedElements.get(element);\r\n    return lock ? lock.cancel(force) : resolve();\r\n}\r\n\r\nfunction removeLock(element) {\r\n    var lock = mapRemove(lockedElements, element);\r\n    if (lock) {\r\n        lock.cancel(true);\r\n    }\r\n}\r\n\r\nfunction DOMLock(element) {\r\n    var self = this;\r\n    _(self, {\r\n        promises: new Map()\r\n    });\r\n    self.element = element;\r\n    lockedElements.set(element, self);\r\n    afterDetached(element, removeLock);\r\n}\r\n\r\ndefinePrototype(DOMLock, {\r\n    get locked() {\r\n        return _(this).promises.size > 0;\r\n    },\r\n    cancel: function (force) {\r\n        var self = this;\r\n        var state = _(self);\r\n        var promises = state.promises;\r\n        if (force || !promises.size) {\r\n            if (promises.size) {\r\n                // @ts-ignore: unable to reflect on interface member\r\n                emitDOMEvent('cancelled', null, self.element);\r\n            }\r\n            // remove all promises from the dictionary so that\r\n            // filtered promise from lock.wait() will be rejected by cancellation\r\n            promises.clear();\r\n            state.handler = null;\r\n            if (state.deferred) {\r\n                state.deferred.resolve();\r\n            }\r\n            return resolve();\r\n        }\r\n        return (state.handler || (state.handler = retryable(function () {\r\n            // request user cancellation for each async task in sequence\r\n            return makeArray(promises).reduce(function (a, v) {\r\n                return a.then(v);\r\n            }, resolve()).then(function () {\r\n                // @ts-ignore: unable to reflect on interface member\r\n                self.cancel(true);\r\n            });\r\n        })))();\r\n    },\r\n    wait: function (promise, oncancel) {\r\n        var self = this;\r\n        var state = _(self);\r\n        var promises = state.promises;\r\n        var finish = function () {\r\n            if (promises.delete(promise) && !promises.size) {\r\n                emitDOMEvent('asyncEnd', null, self.element);\r\n                self.cancel(true);\r\n            }\r\n        };\r\n        promises.set(promise, retryable(oncancel === true ? resolve : oncancel || reject, finish));\r\n        if (promises.size === 1) {\r\n            var callback = {};\r\n            var deferred = new Promise(function (resolve, reject) {\r\n                callback.resolve = resolve;\r\n                callback.reject = reject;\r\n            });\r\n            state.deferred = extend(deferred, callback);\r\n            for (var parent = self.element.parentNode; parent && !lockedElements.has(parent); parent = parent.parentNode);\r\n            if (parent) {\r\n                lockedElements.get(parent).wait(deferred, self.cancel.bind(self));\r\n            }\r\n            emitDOMEvent('asyncStart', null, self.element);\r\n        }\r\n        promise.catch(function (error) {\r\n            if (error && !handledErrors.has(error)) {\r\n                emitDOMEvent('error', null, self.element, {\r\n                    error: error\r\n                }, true);\r\n                // avoid firing error event for the same error for multiple target\r\n                // while propagating through the promise chain\r\n                if (typeof error === 'object') {\r\n                    handledErrors.set(error, true);\r\n                }\r\n            }\r\n            finish();\r\n        });\r\n        return promise.then(function (value) {\r\n            var cancelled = !promises.has(promise);\r\n            finish();\r\n            // the returned promise will be rejected\r\n            // if the current lock has been released or cancelled\r\n            return cancelled ? reject('user_cancelled') : value;\r\n        });\r\n    }\r\n});\r\n\r\nlock(document);\r\nwindow.onbeforeunload = function (e) {\r\n    if (locked(document)) {\r\n        e.returnValue = '';\r\n        e.preventDefault();\r\n    }\r\n};\r\n\r\nexport {\r\n    lock,\r\n    locked,\r\n    cancelLock\r\n};\r\n","import { IS_IE10, IS_MAC, IS_TOUCH } from \"./env.js\";\r\nimport { Map, Set, WeakMap, Promise, $ } from \"./shim.js\";\r\nimport { any, each, extend, lcfirst, map, mapRemove, matchWord, single, ucfirst } from \"./util.js\";\r\nimport { bind, containsOrEquals, dispatchDOMMouseEvent, is, isVisible, makeSelection, parentsAndSelf } from \"./domUtil.js\";\r\nimport { ZetaEventSource, lastEventSource, getContainer, setLastEventSource, getEventSource, emitDOMEvent, listenDOMEvent } from \"./events.js\";\r\nimport { lock, cancelLock, locked } from \"./domLock.js\";\r\nimport { afterDetached, observe, registerCleanup, watchAttributes, watchElements } from \"./observe.js\";\r\n\r\nconst KEYNAMES = JSON.parse('{\"8\":\"backspace\",\"9\":\"tab\",\"13\":\"enter\",\"16\":\"shift\",\"17\":\"ctrl\",\"18\":\"alt\",\"19\":\"pause\",\"20\":\"capsLock\",\"27\":\"escape\",\"32\":\"space\",\"33\":\"pageUp\",\"34\":\"pageDown\",\"35\":\"end\",\"36\":\"home\",\"37\":\"leftArrow\",\"38\":\"upArrow\",\"39\":\"rightArrow\",\"40\":\"downArrow\",\"45\":\"insert\",\"46\":\"delete\",\"48\":\"0\",\"49\":\"1\",\"50\":\"2\",\"51\":\"3\",\"52\":\"4\",\"53\":\"5\",\"54\":\"6\",\"55\":\"7\",\"56\":\"8\",\"57\":\"9\",\"65\":\"a\",\"66\":\"b\",\"67\":\"c\",\"68\":\"d\",\"69\":\"e\",\"70\":\"f\",\"71\":\"g\",\"72\":\"h\",\"73\":\"i\",\"74\":\"j\",\"75\":\"k\",\"76\":\"l\",\"77\":\"m\",\"78\":\"n\",\"79\":\"o\",\"80\":\"p\",\"81\":\"q\",\"82\":\"r\",\"83\":\"s\",\"84\":\"t\",\"85\":\"u\",\"86\":\"v\",\"87\":\"w\",\"88\":\"x\",\"89\":\"y\",\"90\":\"z\",\"91\":\"leftWindow\",\"92\":\"rightWindowKey\",\"93\":\"select\",\"96\":\"numpad0\",\"97\":\"numpad1\",\"98\":\"numpad2\",\"99\":\"numpad3\",\"100\":\"numpad4\",\"101\":\"numpad5\",\"102\":\"numpad6\",\"103\":\"numpad7\",\"104\":\"numpad8\",\"105\":\"numpad9\",\"106\":\"multiply\",\"107\":\"add\",\"109\":\"subtract\",\"110\":\"decimalPoint\",\"111\":\"divide\",\"112\":\"f1\",\"113\":\"f2\",\"114\":\"f3\",\"115\":\"f4\",\"116\":\"f5\",\"117\":\"f6\",\"118\":\"f7\",\"119\":\"f8\",\"120\":\"f9\",\"121\":\"f10\",\"122\":\"f11\",\"123\":\"f12\",\"144\":\"numLock\",\"145\":\"scrollLock\",\"186\":\"semiColon\",\"187\":\"equalSign\",\"188\":\"comma\",\"189\":\"dash\",\"190\":\"period\",\"191\":\"forwardSlash\",\"192\":\"backtick\",\"219\":\"openBracket\",\"220\":\"backSlash\",\"221\":\"closeBracket\",\"222\":\"singleQuote\"}');\r\nconst SELECTOR_FOCUSABLE = ':input, [contenteditable], a[href], area[href], iframe';\r\nconst META_KEYS = [16, 17, 18, 91, 93];\r\n\r\nconst root = document.documentElement;\r\nconst selection = window.getSelection();\r\nconst focusPath = [];\r\nconst focusFriends = new WeakMap();\r\nconst focusElements = new Set();\r\nconst modalElements = new Map();\r\nconst domReady = new Promise($);\r\n\r\nvar windowFocusedOut;\r\nvar currentEvent;\r\n\r\n\r\n/* --------------------------------------\r\n * Helper functions\r\n * -------------------------------------- */\r\n\r\nfunction approxMultipleOf(a, b) {\r\n    return Math.abs(Math.round(a / b) - a / b) < 0.2;\r\n}\r\n\r\nfunction measureLine(p1, p2) {\r\n    var dx = p1.clientX - p2.clientX;\r\n    var dy = p1.clientY - p2.clientY;\r\n    return {\r\n        dx: dx,\r\n        dy: dy,\r\n        deg: Math.atan2(dy, dx) / Math.PI * 180,\r\n        length: Math.sqrt(dx * dx + dy * dy)\r\n    };\r\n}\r\n\r\nfunction textInputAllowed(v) {\r\n    return v.isContentEditable || is(v, 'input,textarea,select');\r\n}\r\n\r\n/* --------------------------------------\r\n * Focus management\r\n * -------------------------------------- */\r\n\r\nfunction focused(element, strict) {\r\n    // @ts-ignore: activeElement is not null\r\n    return element === window ? !windowFocusedOut : focusElements.has(element) && (!strict || containsOrEquals(element, document.activeElement));\r\n}\r\n\r\nfunction focusable(element) {\r\n    var friends = map(parentsAndSelf(element), function (v) {\r\n        return focusFriends.get(v);\r\n    });\r\n    return any(focusPath, function (v) {\r\n        return containsOrEquals(v, element) || friends.indexOf(v) >= 0;\r\n    });\r\n}\r\n\r\nfunction focusLockedWithin(element) {\r\n    return single(modalElements, function (v, i) {\r\n        return $(v).find(element)[0] && i;\r\n    });\r\n}\r\n\r\nfunction triggerFocusEvent(eventName, elements, relatedTarget, source) {\r\n    each(elements, function (i, v) {\r\n        if (getContainer(v, true)) {\r\n            emitDOMEvent(eventName, null, v, {\r\n                relatedTarget: relatedTarget\r\n            }, false, source);\r\n        }\r\n    });\r\n}\r\n\r\nfunction setFocus(element, focusOnInput, source, path) {\r\n    if (focusOnInput && !is(element, SELECTOR_FOCUSABLE)) {\r\n        element = $(SELECTOR_FOCUSABLE, element).filter(':visible:not(:disabled,.disabled)')[0] || element;\r\n    }\r\n    path = path || focusPath;\r\n    if (path[0]) {\r\n        var within = path !== focusPath ? element : focusable(element);\r\n        if (!within) {\r\n            var lockParent = focusLockedWithin(element);\r\n            element = focused(lockParent) ? path[0] : lockParent;\r\n            within = focusable(element);\r\n        }\r\n        if (!within) {\r\n            return false;\r\n        }\r\n        var removed = path.splice(0, path.indexOf(within));\r\n        each(removed, function (i, v) {\r\n            focusElements.delete(v);\r\n        });\r\n        triggerFocusEvent('focusout', removed, element, source);\r\n    }\r\n    // check whether the element is still attached in ROM\r\n    // which can be detached while dispatching focusout event above\r\n    if (containsOrEquals(root, element)) {\r\n        var added = parentsAndSelf(element).filter(function (v) {\r\n            return !focusElements.has(v);\r\n        });\r\n        var friend = map(added, function (v) {\r\n            return focusFriends.get(v);\r\n        })[0];\r\n        if (friend && !focused(friend)) {\r\n            var result = setFocus(friend);\r\n            if (result !== undefined) {\r\n                return result && setFocus(element);\r\n            }\r\n        }\r\n        if (added[0]) {\r\n            path.unshift.apply(path, added);\r\n            each(added, function (i, v) {\r\n                focusElements.add(v);\r\n            });\r\n            triggerFocusEvent('focusin', added, null, source || new ZetaEventSource(added[0], path));\r\n        }\r\n        var activeElement = document.activeElement;\r\n        if (path[0] !== activeElement) {\r\n            path[0].focus();\r\n            // ensure previously focused element is properly blurred\r\n            // in case the new element is not focusable\r\n            if (activeElement && activeElement !== document.body && activeElement !== root && document.activeElement === activeElement) {\r\n                // @ts-ignore: activeElement is HTMLElement\r\n                activeElement.blur();\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n}\r\n\r\nfunction setModal(element, within) {\r\n    var focusWithin = is(within, Node) || root;\r\n    if (!focused(focusWithin)) {\r\n        setFocus(focusWithin);\r\n    }\r\n    modalElements.set(element, focusPath.splice(0, focusWithin === root || document.body ? focusPath.length : focusPath.indexOf(focusWithin)));\r\n    setFocus(element);\r\n}\r\n\r\nfunction retainFocus(a, b) {\r\n    focusFriends.set(b, a);\r\n}\r\n\r\nfunction releaseFocus(b) {\r\n    focusFriends.delete(b);\r\n}\r\n\r\n\r\n/* --------------------------------------\r\n * DOM event handling\r\n * -------------------------------------- */\r\n\r\n\r\ndomReady.then(function () {\r\n    var body = document.body;\r\n    var modifierCount;\r\n    var modifiedKeyCode;\r\n    var mouseInitialPoint;\r\n    var mousedownFocus;\r\n    var normalizeTouchEvents;\r\n    var pressTimeout;\r\n    var imeNode;\r\n    var imeOffset;\r\n    var imeText;\r\n\r\n    function getEventName(e, suffix) {\r\n        var mod = ((e.ctrlKey || e.metaKey) ? 'Ctrl' : '') + (e.altKey ? 'Alt' : '') + (e.shiftKey ? 'Shift' : '');\r\n        return mod ? lcfirst(mod + ucfirst(suffix)) : suffix;\r\n    }\r\n\r\n    function updateIMEState() {\r\n        var element = document.activeElement || root;\r\n        if ('selectionEnd' in element) {\r\n            imeNode = element;\r\n            // @ts-ignore: guranteed having selectionEnd property\r\n            imeOffset = element.selectionEnd;\r\n        } else {\r\n            // @ts-ignore: selection is not null\r\n            imeNode = selection.anchorNode;\r\n            // @ts-ignore: selection is not null\r\n            imeOffset = selection.anchorOffset;\r\n            if (imeNode && imeNode.nodeType === 1) {\r\n                // IE puts selection at element level\r\n                // however it will insert text in the previous text node\r\n                var child = imeNode.childNodes[imeOffset - 1];\r\n                if (child && child.nodeType === 3) {\r\n                    imeNode = child;\r\n                    // @ts-ignore: child is Text\r\n                    imeOffset = child.length;\r\n                } else {\r\n                    imeNode = imeNode.childNodes[imeOffset];\r\n                    imeOffset = 0;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    function triggerUIEvent(eventName, data, target) {\r\n        return emitDOMEvent(eventName, currentEvent, target || focusPath[0], data, true);\r\n    }\r\n\r\n    function triggerKeystrokeEvent(keyName, char) {\r\n        var data = {\r\n            data: keyName,\r\n            char: char\r\n        };\r\n        lastEventSource.sourceKeyName = keyName;\r\n        if (triggerUIEvent('keystroke', data)) {\r\n            currentEvent.preventDefault();\r\n            return true;\r\n        }\r\n    }\r\n\r\n    function triggerMouseEvent(eventName, nativeEvent) {\r\n        var point = mouseInitialPoint || nativeEvent;\r\n        return emitDOMEvent(eventName, nativeEvent, nativeEvent.target, {\r\n            target: nativeEvent.target,\r\n            clientX: point.clientX,\r\n            clientY: point.clientY,\r\n            metakey: getEventName(nativeEvent)\r\n        });\r\n    }\r\n\r\n    function triggerGestureEvent(gesture, nativeEvent) {\r\n        mouseInitialPoint = null;\r\n        return emitDOMEvent('gesture', nativeEvent, focusPath.slice(-1)[0], gesture, true);\r\n    }\r\n\r\n    if (IS_IE10) {\r\n        // polyfill for pointer-events: none for IE10\r\n        bind(body, 'mousedown mouseup mousemove mouseenter mouseleave click dblclick contextmenu wheel', function (e) {\r\n            // @ts-ignore: e.target is Element\r\n            if (getComputedStyle(e.target).pointerEvents === 'none') {\r\n                e.stopPropagation();\r\n                e.stopImmediatePropagation();\r\n                // @ts-ignore: e.target is Element\r\n                if (!e.bubbles || !dispatchDOMMouseEvent(e.type, e, e)) {\r\n                    e.preventDefault();\r\n                }\r\n            }\r\n        }, true);\r\n    }\r\n\r\n    bind(window, 'mousedown mouseup wheel compositionstart compositionend beforeinput textInput keydown keyup keypress touchstart touchend cut copy paste drop click dblclick contextmenu', function (e) {\r\n        currentEvent = e;\r\n        setTimeout(function () {\r\n            currentEvent = null;\r\n        });\r\n        setLastEventSource(null);\r\n        if (!focusable(e.target)) {\r\n            e.stopImmediatePropagation();\r\n            e.preventDefault();\r\n            if (matchWord(e.type, 'touchstart mousedown keydown')) {\r\n                emitDOMEvent('focusreturn', null, focusPath.slice(-1)[0]);\r\n            }\r\n        }\r\n        setLastEventSource(e.target);\r\n    }, true);\r\n\r\n    bind(root, {\r\n        compositionstart: function () {\r\n            updateIMEState();\r\n            imeText = '';\r\n        },\r\n        compositionupdate: function (e) {\r\n            imeText = e.data;\r\n        },\r\n        compositionend: function (e) {\r\n            var isInputElm = 'selectionEnd' in imeNode;\r\n            var prevText = imeText;\r\n            var prevOffset = imeOffset;\r\n            updateIMEState();\r\n\r\n            var curText = imeNode.value || imeNode.data || '';\r\n            imeText = e.data;\r\n            // some IME lacks inserted character sequence when selecting from phrase candidate list\r\n            // also legacy Microsoft Changjie IME reports full-width spaces (U+3000) instead of actual characters\r\n            if (!imeText || /^\\u3000+$/.test(imeText)) {\r\n                imeText = curText.slice(prevOffset, imeOffset);\r\n            }\r\n\r\n            // some old mobile browsers fire compositionend event before replacing final character sequence\r\n            // need to compare both to truncate the correct range of characters\r\n            // three cases has been observed: XXX{imeText}|, XXX{prevText}| and XXX|{imeText}\r\n            var o1 = imeOffset - imeText.length;\r\n            var o2 = imeOffset - prevText.length;\r\n            var startOffset = imeOffset;\r\n            if (curText.slice(o1, imeOffset) === imeText) {\r\n                startOffset = o1;\r\n            } else if (curText.slice(o2, imeOffset) === prevText) {\r\n                startOffset = o2;\r\n            } else if (curText.substr(imeOffset, imeText.length) === imeText) {\r\n                imeOffset += imeText.length;\r\n            }\r\n            var newText = curText.substr(0, startOffset) + curText.slice(imeOffset);\r\n            if (isInputElm) {\r\n                imeNode.value = newText;\r\n                imeNode.setSelectionRange(startOffset, startOffset);\r\n            } else {\r\n                imeNode.data = newText;\r\n                makeSelection(imeNode, startOffset);\r\n            }\r\n            if (!triggerUIEvent('textInput', imeText)) {\r\n                if (isInputElm) {\r\n                    imeNode.value = curText;\r\n                    imeNode.setSelectionRange(imeOffset, imeOffset);\r\n                } else {\r\n                    imeNode.data = curText;\r\n                    makeSelection(imeNode, imeOffset);\r\n                }\r\n            }\r\n            imeNode = null;\r\n            setTimeout(function () {\r\n                imeText = null;\r\n            });\r\n        },\r\n        textInput: function (e) {\r\n            // required for older mobile browsers that do not support beforeinput event\r\n            // ignore in case browser fire textInput before/after compositionend\r\n            if (!imeNode && (e.data === imeText || triggerUIEvent('textInput', e.data))) {\r\n                e.preventDefault();\r\n            }\r\n        },\r\n        keydown: function (e) {\r\n            if (!imeNode) {\r\n                var keyCode = e.keyCode;\r\n                var isModifierKey = (META_KEYS.indexOf(keyCode) >= 0);\r\n                if (isModifierKey && keyCode !== modifiedKeyCode) {\r\n                    triggerUIEvent('metakeychange', getEventName(e));\r\n                }\r\n                var isSpecialKey = !isModifierKey && (KEYNAMES[keyCode] || '').length > 1 && !(keyCode >= 186 || (keyCode >= 96 && keyCode <= 111));\r\n                // @ts-ignore: boolean arithmetic\r\n                modifierCount = e.ctrlKey + e.shiftKey + e.altKey + e.metaKey + !isModifierKey;\r\n                // @ts-ignore: boolean arithmetic\r\n                modifierCount *= isSpecialKey || ((modifierCount > 2 || (modifierCount > 1 && !e.shiftKey)) && !isModifierKey);\r\n                modifiedKeyCode = keyCode;\r\n                if (modifierCount) {\r\n                    triggerKeystrokeEvent(getEventName(e, KEYNAMES[keyCode] || e.key), keyCode === 32 ? ' ' : '');\r\n                }\r\n            }\r\n        },\r\n        keyup: function (e) {\r\n            var isModifierKey = (META_KEYS.indexOf(e.keyCode) >= 0);\r\n            if (!imeNode && (isModifierKey || modifiedKeyCode === e.keyCode)) {\r\n                modifiedKeyCode = null;\r\n                modifierCount--;\r\n                if (isModifierKey) {\r\n                    triggerUIEvent('metakeychange', getEventName(e) || '');\r\n                }\r\n            }\r\n        },\r\n        keypress: function (e) {\r\n            var data = e.char || e.key || String.fromCharCode(e.charCode);\r\n            // @ts-ignore: non-standard member\r\n            if (!imeNode && !modifierCount && (e.synthetic || !('onbeforeinput' in e.target))) {\r\n                triggerKeystrokeEvent(getEventName(e, KEYNAMES[modifiedKeyCode] || data), data);\r\n            }\r\n        },\r\n        beforeinput: function (e) {\r\n            if (!imeNode && e.cancelable) {\r\n                switch (e.inputType) {\r\n                    case 'insertText':\r\n                        return triggerUIEvent('textInput', e.data);\r\n                    case 'deleteContent':\r\n                    case 'deleteContentBackward':\r\n                        return triggerKeystrokeEvent('backspace', '');\r\n                    case 'deleteContentForward':\r\n                        return triggerKeystrokeEvent('delete', '');\r\n                }\r\n            }\r\n        },\r\n        touchstart: function (e) {\r\n            // @ts-ignore: e.target is Element\r\n            var container = getContainer(e.target);\r\n            normalizeTouchEvents = container.normalizeTouchEvents;\r\n            mouseInitialPoint = extend({}, e.touches[0]);\r\n            if (!e.touches[1]) {\r\n                // @ts-ignore: e.target is Element\r\n                if (normalizeTouchEvents && focused(container.element)) {\r\n                    triggerMouseEvent('mousedown', e);\r\n                }\r\n                pressTimeout = setTimeout(function () {\r\n                    if (mouseInitialPoint) {\r\n                        triggerMouseEvent('longPress', e);\r\n                        mouseInitialPoint = null;\r\n                    }\r\n                }, 1000);\r\n            }\r\n        },\r\n        touchmove: function (e) {\r\n            clearTimeout(pressTimeout);\r\n            pressTimeout = null;\r\n            if (mouseInitialPoint) {\r\n                if (!e.touches[1]) {\r\n                    var line = measureLine(e.touches[0], mouseInitialPoint);\r\n                    if (line.length > 50 && approxMultipleOf(line.deg, 90)) {\r\n                        triggerGestureEvent('swipe' + (approxMultipleOf(line.deg, 180) ? (line.dx > 0 ? 'Right' : 'Left') : (line.dy > 0 ? 'Bottom' : 'Top')), e);\r\n                    }\r\n                } else if (!e.touches[2]) {\r\n                    triggerGestureEvent('pinchZoom', e);\r\n                }\r\n            }\r\n        },\r\n        touchend: function (e) {\r\n            clearTimeout(pressTimeout);\r\n            if (normalizeTouchEvents && mouseInitialPoint && pressTimeout) {\r\n                setFocus(e.target);\r\n                triggerMouseEvent('click', e);\r\n                dispatchDOMMouseEvent('click', mouseInitialPoint, e);\r\n                e.preventDefault();\r\n            }\r\n        },\r\n        mousedown: function (e) {\r\n            setFocus(e.target);\r\n            if ((e.buttons || e.which) === 1) {\r\n                triggerMouseEvent('mousedown', e);\r\n            }\r\n            mouseInitialPoint = e;\r\n            mousedownFocus = document.activeElement;\r\n        },\r\n        mousemove: function (e) {\r\n            if (mouseInitialPoint && measureLine(e, mouseInitialPoint).length > 5) {\r\n                mouseInitialPoint = null;\r\n            }\r\n        },\r\n        mouseup: function () {\r\n            if (mousedownFocus && document.activeElement !== mousedownFocus) {\r\n                mousedownFocus.focus();\r\n            }\r\n        },\r\n        wheel: function (e) {\r\n            // @ts-ignore: e.target is Element\r\n            if (containsOrEquals(e.target, focusPath[0]) || !textInputAllowed(e.target)) {\r\n                var dir = e.deltaY || e.detail;\r\n                if (dir && triggerUIEvent('mousewheel', dir / Math.abs(dir) * (IS_MAC ? -1 : 1))) {\r\n                    e.preventDefault();\r\n                }\r\n            }\r\n        },\r\n        click: function (e) {\r\n            if (!IS_TOUCH && mouseInitialPoint) {\r\n                triggerMouseEvent('click', e);\r\n            }\r\n        },\r\n        contextmenu: function (e) {\r\n            triggerMouseEvent('rightClick', e);\r\n        },\r\n        dblclick: function (e) {\r\n            triggerMouseEvent('dblclick', e);\r\n        },\r\n        focusin: function (e) {\r\n            windowFocusedOut = false;\r\n            if (focusable(e.target)) {\r\n                setFocus(e.target, false, lastEventSource);\r\n            } else {\r\n                // @ts-ignore: e.target is Element\r\n                e.target.blur();\r\n            }\r\n        },\r\n        focusout: function (e) {\r\n            // browser set focus to body if the focused element is no longer visible\r\n            // which is not a desirable behavior in many cases\r\n            // find the first visible element in focusPath to focus\r\n            // @ts-ignore: e.target is Element\r\n            if (!e.relatedTarget && !isVisible(e.target)) {\r\n                var cur = any(focusPath.slice(focusPath.indexOf(e.target) + 1), isVisible);\r\n                if (cur) {\r\n                    setFocus(cur, false, lastEventSource);\r\n                }\r\n            }\r\n        }\r\n    }, true);\r\n\r\n    bind(window, {\r\n        wheel: function (e) {\r\n            // scrolling will happen on first scrollable element up the DOM tree\r\n            // prevent scrolling if interaction on such element should be blocked by modal element\r\n            var deltaX = -e.deltaX;\r\n            var deltaY = -e.deltaY;\r\n            // @ts-ignore: e.target is Element\r\n            for (var cur = e.target; cur && cur !== root; cur = cur.parentNode) {\r\n                // @ts-ignore: e.target is Element\r\n                var style = getComputedStyle(cur);\r\n                // @ts-ignore: e.target is Element\r\n                if (cur.scrollWidth > cur.offsetWidth && matchWord(style.overflowX, 'auto scroll') && ((deltaX > 0 && cur.scrollLeft > 0) || (deltaX < 0 && cur.scrollLeft + cur.offsetWidth < cur.scrollWidth))) {\r\n                    break;\r\n                }\r\n                // @ts-ignore: e.target is Element\r\n                if (cur.scrollHeight > cur.offsetHeight && matchWord(style.overflowY, 'auto scroll') && ((deltaY > 0 && cur.scrollTop > 0) || (deltaY < 0 && cur.scrollTop + cur.offsetHeight < cur.scrollHeight))) {\r\n                    break;\r\n                }\r\n            }\r\n            if (!focusable(cur)) {\r\n                e.preventDefault();\r\n            }\r\n        },\r\n        blur: function (e) {\r\n            if (e.target === window) {\r\n                windowFocusedOut = true;\r\n            }\r\n        }\r\n    });\r\n\r\n    registerCleanup(function () {\r\n        each(modalElements, function (element, modelPath) {\r\n            if (!containsOrEquals(root, element) && mapRemove(modalElements, element) && focused(element)) {\r\n                var path = any(modalElements, function (w) {\r\n                    return w.indexOf(element) >= 0;\r\n                }) || focusPath;\r\n                path.push.apply(path, modelPath);\r\n                setFocus(modelPath[0], false, null, path);\r\n            }\r\n        });\r\n        for (var i = focusPath.length - 1; i >= 0; i--) {\r\n            if (!containsOrEquals(root, focusPath[i])) {\r\n                setFocus(focusPath[i + 1] || body);\r\n                break;\r\n            }\r\n        }\r\n    });\r\n    setFocus(document.activeElement);\r\n});\r\n\r\n\r\n/* --------------------------------------\r\n * Exports\r\n * -------------------------------------- */\r\n\r\nexport default {\r\n    get event() {\r\n        return currentEvent;\r\n    },\r\n    get context() {\r\n        return getContainer(focusPath[0]).context;\r\n    },\r\n    get activeElement() {\r\n        return focusPath[0];\r\n    },\r\n    get focusedElements() {\r\n        return focusPath.slice(0);\r\n    },\r\n    get eventSource() {\r\n        return getEventSource();\r\n    },\r\n    root,\r\n    ready: domReady,\r\n\r\n    textInputAllowed,\r\n    focusable,\r\n    focused,\r\n    setModal,\r\n    retainFocus,\r\n    releaseFocus,\r\n    focus: function (element) {\r\n        setFocus(element, true);\r\n    },\r\n\r\n    getEventSource,\r\n    on: listenDOMEvent,\r\n    emit: function (eventName, element, data, bubbles) {\r\n        return emitDOMEvent(eventName, null, element, data, bubbles);\r\n    },\r\n\r\n    lock,\r\n    locked,\r\n    cancelLock,\r\n\r\n    observe,\r\n    registerCleanup,\r\n    afterDetached,\r\n    watchElements,\r\n    watchAttributes\r\n};\r\n","import { Map, WeakMap } from \"./shim.js\";\r\nimport { createPrivateStore, definePrototype, each, extend, isFunction, isPlainObject, keys, kv, mapGet, mapRemove, matchWord, randomId, reject, resolve, setImmediateOnce, single, splice, throwNotFunction } from \"./util.js\";\r\nimport { containsOrEquals, is, parentsAndSelf } from \"./domUtil.js\";\r\nimport { afterDetached } from \"./observe.js\";\r\nimport dom from \"./dom.js\";\r\n\r\nconst _ = createPrivateStore();\r\nconst root = document.documentElement;\r\nconst containers = new WeakMap();\r\nconst domEventTrap = new ZetaEventContainer();\r\nconst domContainer = new ZetaEventContainer();\r\nconst asyncEventData = new Map();\r\nconst asyncEvents = [];\r\n\r\nexport var eventSource;\r\nexport var lastEventSource;\r\n\r\n\r\n/* --------------------------------------\r\n * Helper functions\r\n * -------------------------------------- */\r\n\r\nfunction ZetaEventSource(target, path) {\r\n    var self = this;\r\n    path = path || (eventSource ? eventSource.path : dom.focusedElements);\r\n    self.path = path;\r\n    self.source = 'script';\r\n    if (containsOrEquals(path[0] || root, target) || path.indexOf(target) >= 0) {\r\n        self.source = eventSource ? eventSource.source : getEventSourceName();\r\n    }\r\n    self.sourceKeyName = self.source !== 'keyboard' ? null : (eventSource || lastEventSource || '').sourceKeyName;\r\n}\r\n\r\nfunction setLastEventSource(source) {\r\n    lastEventSource = new ZetaEventSource(source);\r\n}\r\n\r\nfunction prepEventSource(promise) {\r\n    var source = eventSource || new ZetaEventSource(dom.activeElement);\r\n    var wrap = function (callback) {\r\n        return function () {\r\n            var prev = eventSource;\r\n            try {\r\n                eventSource = source;\r\n                return callback.apply(this, arguments);\r\n            } finally {\r\n                eventSource = prev;\r\n            }\r\n        };\r\n    };\r\n    return {\r\n        then: function (a, b) {\r\n            return promise.then(a && wrap(a), b && wrap(b));\r\n        },\r\n        catch: function (a) {\r\n            return promise.catch(a && wrap(a));\r\n        }\r\n    };\r\n}\r\n\r\nfunction getEventSource(element) {\r\n    return element ? new ZetaEventSource(element).source : getEventSourceName();\r\n}\r\n\r\nfunction getEventSourceName() {\r\n    var event = dom.event || window.event;\r\n    var type = (event && event.type) || '';\r\n    return type[0] === 'k' || type.substr(0, 3) === 'com' ? 'keyboard' : type[0] === 't' ? 'touch' : type[0] === 'm' || matchWord(type, 'wheel click dblclick contextmenu') ? 'mouse' : matchWord(type, 'drop cut copy paste') || 'script';\r\n}\r\n\r\nfunction getContainer(element, exact) {\r\n    if (exact) {\r\n        return mapGet(containers, element);\r\n    }\r\n    for (var cur = element; cur && !containers.has(cur); cur = cur.parentNode);\r\n    return mapGet(containers, cur) || domContainer;\r\n}\r\n\r\nfunction emitDOMEvent(eventName, nativeEvent, target, data, bubbles, source) {\r\n    var emitter = new ZetaEventEmitter(eventName, domContainer, target, data, nativeEvent, bubbles, source);\r\n    return emitter.emit(domEventTrap, 'tap', getContainer(target).element, true) || emitter.emit();\r\n}\r\n\r\nfunction listenDOMEvent(element, event, handler) {\r\n    if (!is(element, Node)) {\r\n        handler = event;\r\n        event = element;\r\n        element = root;\r\n    }\r\n    domContainer.add(element, isPlainObject(event) || kv(event, handler));\r\n}\r\n\r\nfunction registerAsyncEvent(eventName, container, target, data, bubbles, mergeData) {\r\n    var map = mapGet(asyncEventData, container, Map);\r\n    var dict = mapGet(map, target || container.element, Object);\r\n    if (dict[eventName] && (isFunction(mergeData) || (data === undefined && dict[eventName].data === undefined))) {\r\n        dict[eventName].data = mergeData && mergeData(dict[eventName].data, data);\r\n    } else {\r\n        dict[eventName] = new ZetaEventEmitter(eventName, container, target, data, null, bubbles);\r\n        asyncEvents.push(dict[eventName]);\r\n        setImmediateOnce(emitAsyncEvents);\r\n    }\r\n}\r\n\r\nfunction removeAsyncEvent(eventName, container, target) {\r\n    var map = mapGet(asyncEventData, container);\r\n    var dict = map && mapGet(map, target);\r\n    if (dict && dict[eventName]) {\r\n        var event = dict[eventName];\r\n        delete dict[eventName];\r\n        asyncEvents.splice(asyncEvents.indexOf(event), 1);\r\n        return event.data || { data: event.data };\r\n    }\r\n}\r\n\r\nfunction emitAsyncEvents(container) {\r\n    var events;\r\n    if (!container) {\r\n        events = asyncEvents.splice(0);\r\n        asyncEventData.clear();\r\n    } else if (mapRemove(asyncEventData, container)) {\r\n        events = splice(asyncEvents, function (v) {\r\n            return v.container === container;\r\n        });\r\n    }\r\n    each(events, function (i, v) {\r\n        v.emit();\r\n    });\r\n}\r\n\r\n/* --------------------------------------\r\n * ZetaEventEmitter\r\n * -------------------------------------- */\r\n\r\nfunction ZetaEventEmitter(eventName, container, target, data, originalEvent, bubbles, source) {\r\n    target = target || container.element;\r\n    source = source || new ZetaEventSource(target);\r\n    var properties = {\r\n        source: source.source,\r\n        sourceKeyName: source.sourceKeyName,\r\n        timestamp: performance.now(),\r\n        originalEvent: originalEvent || null\r\n    };\r\n    extend(this, {\r\n        container: container,\r\n        eventName: eventName,\r\n        target: target,\r\n        data: data,\r\n        bubbles: !!bubbles,\r\n        properties: properties,\r\n        sourceObj: source\r\n    }, properties);\r\n}\r\n\r\ndefinePrototype(ZetaEventEmitter, {\r\n    emit: function (container, eventName, target, bubbles) {\r\n        var self = this;\r\n        container = container || self.container;\r\n        if (bubbles === undefined) {\r\n            bubbles = self.bubbles;\r\n        }\r\n        var components = _(container).components;\r\n        // @ts-ignore: type inference issue\r\n        var targets = !bubbles ? [target || self.target] : self.originalEvent && target === undefined ? self.sourceObj.path : parentsAndSelf(target || self.target);\r\n        return single(targets, function (v) {\r\n            var component = components.get(v);\r\n            return component && emitterCallHandlers(self, component, self.eventName, eventName, self.data);\r\n        });\r\n    }\r\n});\r\n\r\nfunction emitterCallHandlers(emitter, component, eventName, handlerName, data) {\r\n    handlerName = handlerName || eventName;\r\n    if (matchWord(handlerName, 'keystroke gesture') && emitterCallHandlers(emitter, component, data)) {\r\n        return emitter.result;\r\n    }\r\n    if (data === undefined) {\r\n        data = removeAsyncEvent(eventName, component.container, context);\r\n    }\r\n    var handlers = component.handlers[handlerName];\r\n    if (handlers) {\r\n        var context = component.context;\r\n        var contextContainer = is(context, ZetaEventContainer) || component.container;\r\n        var event = new ZetaEvent(emitter, eventName, component, data);\r\n        var prevEventSource = eventSource;\r\n        var prevEvent = contextContainer.event;\r\n        contextContainer.event = event;\r\n        eventSource = emitter.sourceObj;\r\n        try {\r\n            var returnValue = single(handlers, function (v) {\r\n                return v.call(context, event, context);\r\n            });\r\n            if (returnValue !== undefined) {\r\n                emitter.result = resolve(returnValue);\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n            emitter.result = reject(e);\r\n        }\r\n        eventSource = prevEventSource;\r\n        contextContainer.event = prevEvent;\r\n    }\r\n    if (!emitter.result && handlerName === 'keystroke' && data.char && dom.textInputAllowed(emitter.target)) {\r\n        emitterCallHandlers(emitter, component, 'textInput', null, data.char);\r\n    }\r\n    return emitter.result;\r\n}\r\n\r\n/* --------------------------------------\r\n * ZetaEvent\r\n * -------------------------------------- */\r\n\r\nfunction ZetaEvent(event, eventName, component, data) {\r\n    var self = extend(this, event.properties);\r\n    self.eventName = eventName;\r\n    self.type = eventName;\r\n    self.context = component.context;\r\n    self.target = containsOrEquals(event.target, component.element) ? component.element : event.target;\r\n    self.data = null;\r\n    if (isPlainObject(data)) {\r\n        extend(self, data);\r\n    } else if (data !== undefined) {\r\n        self.data = data;\r\n    }\r\n    _(self, event);\r\n}\r\n\r\ndefinePrototype(ZetaEvent, {\r\n    handled: function (promise) {\r\n        var event = _(this);\r\n        if (!event.result) {\r\n            event.result = resolve(promise);\r\n        }\r\n    },\r\n    isHandled: function () {\r\n        return !!_(this).result;\r\n    },\r\n    preventDefault: function () {\r\n        var event = this.originalEvent;\r\n        if (event) {\r\n            event.preventDefault();\r\n        } else {\r\n            _(this).defaultPrevented = true;\r\n        }\r\n    },\r\n    isDefaultPrevented: function () {\r\n        return !!(this.originalEvent || _(this)).defaultPrevented;\r\n    }\r\n});\r\n\r\n\r\n/* --------------------------------------\r\n * ZetaEventContainer\r\n * -------------------------------------- */\r\n\r\nfunction ZetaEventContainer(element, context, options) {\r\n    var self = this;\r\n    _(self, {\r\n        components: new Map()\r\n    });\r\n    extend(self, {\r\n        element: element || root,\r\n        context: context || null,\r\n        autoDestroy: containsOrEquals(root, element),\r\n        normalizeTouchEvents: false,\r\n        captureDOMEvents: false\r\n    }, options);\r\n    if (element && self.captureDOMEvents) {\r\n        domEventTrap.setContext(element, self);\r\n        containers.set(element, self);\r\n    }\r\n    if (self.autoDestroy) {\r\n        afterDetached(element, function () {\r\n            self.destroy();\r\n        });\r\n    }\r\n}\r\n\r\ndefinePrototype(ZetaEventContainer, {\r\n    event: null,\r\n    tap: function (handler) {\r\n        domEventTrap.add(this.element, 'tap', handler);\r\n    },\r\n    getContext: function (element) {\r\n        var components = _(this).components;\r\n        var component;\r\n        for (var cur = element; cur && !component; cur = cur.parentNode) {\r\n            component = components.get(cur);\r\n        }\r\n        return component && component.context;\r\n    },\r\n    setContext: function (element, context) {\r\n        containerCreateContext(this, element, context);\r\n    },\r\n    add: function (target, event, handler) {\r\n        var self = this;\r\n        var key = randomId();\r\n        var handlers = containerCreateContext(self, target).handlers;\r\n        each(isPlainObject(event) || kv(event, handler), function (i, v) {\r\n            var dict = handlers[i] || (handlers[i] = {});\r\n            dict[key] = throwNotFunction(v);\r\n        });\r\n        return key;\r\n    },\r\n    delete: function (target, key) {\r\n        var self = this;\r\n        var components = _(self).components;\r\n        var component = mapGet(components, target);\r\n        if (component) {\r\n            if (key) {\r\n                var handlers = component.handlers;\r\n                each(handlers, function (i, v) {\r\n                    delete v[key];\r\n                    if (!keys(v)[0]) {\r\n                        delete this[i];\r\n                    }\r\n                });\r\n                if (keys(handlers)[0]) {\r\n                    return;\r\n                }\r\n            }\r\n            components.delete(target);\r\n            if (self.captureDOMEvents) {\r\n                containers.delete(component.element);\r\n            }\r\n        }\r\n    },\r\n    emit: function (eventName, target, data, bubbles) {\r\n        var emitter = is(eventName, ZetaEvent) ? _(eventName) : new ZetaEventEmitter(eventName, this, target, data, null, bubbles);\r\n        return emitter.emit(this, null, target, bubbles);\r\n    },\r\n    emitAsync: function (eventName, target, data, bubbles, mergeData) {\r\n        registerAsyncEvent(eventName, this, target, data, bubbles, mergeData);\r\n    },\r\n    flushEvents: function () {\r\n        emitAsyncEvents(this);\r\n    },\r\n    destroy: function () {\r\n        var self = this;\r\n        if (self.captureDOMEvents) {\r\n            domEventTrap.delete(self.element);\r\n            containers.delete(self.element);\r\n            each(_(self).components, function (i) {\r\n                containers.delete(i);\r\n            });\r\n        }\r\n    }\r\n});\r\n\r\nfunction containerCreateContext(container, element, context) {\r\n    var cur = mapGet(_(container).components, element, function () {\r\n        return {\r\n            container: container,\r\n            element: element,\r\n            context: context || element,\r\n            handlers: {}\r\n        };\r\n    });\r\n    if (context && (cur.context || context) !== context) {\r\n        throw new Error('Element has already been set to another context');\r\n    }\r\n    if (container.captureDOMEvents && is(element, Element)) {\r\n        containers.set(element, self);\r\n    }\r\n    return cur;\r\n}\r\n\r\nexport {\r\n    ZetaEventContainer,\r\n    ZetaEventSource,\r\n    emitDOMEvent,\r\n    listenDOMEvent,\r\n    getContainer,\r\n    getEventSource,\r\n    prepEventSource,\r\n    setLastEventSource\r\n};\r\n","import { Set, Map, WeakMap, Promise } from \"./shim.js\";\r\nimport { any, each, extend, grep, isFunction, makeArray, map, mapGet, mapRemove, setImmediateOnce, throwNotFunction } from \"./util.js\";\r\nimport { bind, containsOrEquals, selectIncludeSelf } from \"./domUtil.js\";\r\nimport dom from \"./dom.js\";\r\n\r\nconst root = document.documentElement;\r\nconst detachHandlers = new WeakMap();\r\nconst optionsForChildList = {\r\n    subtree: true,\r\n    childList: true\r\n};\r\n\r\nconst MutationObserver = window.MutationObserver || (function () {\r\n    function MutationObserver(handler) {\r\n        var self = this;\r\n        this.records = [];\r\n        this.handler = function () {\r\n            handler(self.takeRecords(), self);\r\n        };\r\n        throwNotFunction(handler);\r\n    }\r\n    MutationObserver.prototype = {\r\n        observe: function (element, init) {\r\n            var self = this;\r\n            var attributeFilter = init.attributeFilter;\r\n            if (attributeFilter) {\r\n                attributeFilter = attributeFilter.map(function (v) {\r\n                    return String(v).toLowerCase();\r\n                });\r\n            }\r\n            bind(element, 'DOMNodeInserted DOMNodeRemoved DOMAttrModified DOMCharacterDataModified', function (e) {\r\n                var type = e.type.charAt(7);\r\n                // @ts-ignore: non-standard member\r\n                var oldValue = e.prevValue;\r\n                var record = {};\r\n                record.addedNodes = [];\r\n                record.removedNodes = [];\r\n                if (type === 'M') {\r\n                    // @ts-ignore: non-standard member\r\n                    if (!attributeFilter || attributeFilter.indexOf(e.attrName.toLowerCase()) >= 0) {\r\n                        record.type = 'attributes';\r\n                        record.target = e.target;\r\n                        // @ts-ignore: non-standard member\r\n                        record.attributeName = e.attrName;\r\n                        if (init.attributeOldValue) {\r\n                            record.oldValue = oldValue;\r\n                        }\r\n                    }\r\n                } else if (type === 'a') {\r\n                    record.type = 'characterData';\r\n                    record.target = e.target;\r\n                    if (init.characterDataOldValue) {\r\n                        record.oldValue = oldValue;\r\n                    }\r\n                } else {\r\n                    record.type = 'childList';\r\n                    // @ts-ignore: e.target is Element\r\n                    record.target = e.target.parentNode;\r\n                    record[type === 'I' ? 'addedNodes' : 'removedNodes'][0] = e.target;\r\n                }\r\n                var shouldIgnore = any(self.records, function (v) {\r\n                    return v.type === 'childList' && v.addedNodes.some(function (v) {\r\n                        return containsOrEquals(v, record.target);\r\n                    });\r\n                });\r\n                if (!shouldIgnore && init[record.type] && (init.subtree || record.target === element)) {\r\n                    self.records[self.records.length] = record;\r\n                    setImmediateOnce(self.handler);\r\n                }\r\n            });\r\n        },\r\n        takeRecords: function () {\r\n            return this.records.splice(0);\r\n        }\r\n    };\r\n    return MutationObserver;\r\n}());\r\n\r\nfunction DetachHandlerState() {\r\n    this.handlers = []\r\n    this.map = new Map();\r\n}\r\n\r\nfunction observe(element, options, callback) {\r\n    callback = throwNotFunction(callback || options);\r\n    if (isFunction(options)) {\r\n        options = optionsForChildList;\r\n    }\r\n    var processRecords = function (records) {\r\n        records = records.filter(function (v) {\r\n            // filter out changes due to sizzle engine\r\n            // to prevent excessive invocation due to querying elements through jQuery\r\n            return v.attributeName !== 'id' || ((v.oldValue || '').slice(0, 6) !== 'sizzle' && (v.target.id !== (v.oldValue || '')));\r\n        });\r\n        if (records[0]) {\r\n            callback(records);\r\n        }\r\n    };\r\n    var observer = new MutationObserver(processRecords);\r\n    observer.observe(element, options);\r\n    return function () {\r\n        processRecords(observer.takeRecords());\r\n    };\r\n}\r\n\r\nfunction registerCleanup(callback) {\r\n    var state = mapGet(detachHandlers, root, DetachHandlerState);\r\n    state.handlers.push(throwNotFunction(callback));\r\n}\r\n\r\nfunction afterDetached(element, from, callback) {\r\n    if (isFunction(from)) {\r\n        callback = from;\r\n        from = root;\r\n    }\r\n    if (!mapGet(detachHandlers, from)) {\r\n        initDetachWatcher(from);\r\n    }\r\n    var promise;\r\n    if (!isFunction(callback)) {\r\n        promise = new Promise(function (resolve) {\r\n            callback = resolve;\r\n        });\r\n    }\r\n    var state = mapGet(detachHandlers, from, DetachHandlerState);\r\n    mapGet(state.map, element, Array).push(callback);\r\n    return promise;\r\n}\r\n\r\nfunction watchElements(element, selector, callback, fireInit) {\r\n    var collection = new Set();\r\n    var add = collection.add.bind(collection);\r\n    var remove = collection.delete.bind(collection);\r\n    var options = extend({}, optionsForChildList, {\r\n        attributes: selector.indexOf('[') >= 0\r\n    });\r\n    observe(element, options, function () {\r\n        var matched = selectIncludeSelf(selector, element);\r\n        var removedNodes = grep(collection, function (v) {\r\n            return matched.indexOf(v) < 0;\r\n        });\r\n        var addedNodes = matched.filter(function (v) {\r\n            return !collection.has(v);\r\n        });\r\n        if (addedNodes[0] || removedNodes[0]) {\r\n            addedNodes.forEach(add);\r\n            removedNodes.forEach(remove);\r\n            callback(addedNodes, removedNodes);\r\n        }\r\n    });\r\n    if (fireInit) {\r\n        dom.ready.then(function () {\r\n            var matched = selectIncludeSelf(selector, element);\r\n            if (matched[0]) {\r\n                matched.forEach(add);\r\n                callback(matched, []);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nfunction watchAttributes(element, attributes, callback, fireInit) {\r\n    var options = {\r\n        subtree: true,\r\n        attributes: true,\r\n        attributeFilter: makeArray(attributes)\r\n    };\r\n    observe(element, options, function (records) {\r\n        var set = new Set();\r\n        each(records, function (i, v) {\r\n            set.add(v.target);\r\n        });\r\n        callback(makeArray(set));\r\n    });\r\n    if (fireInit) {\r\n        dom.ready.then(function () {\r\n            var matched = selectIncludeSelf('[' + options.attributeFilter.join('],[') + ']', element);\r\n            if (matched[0]) {\r\n                callback(matched);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nfunction initDetachWatcher(element) {\r\n    observe(element, function (records) {\r\n        var state = mapGet(detachHandlers, element);\r\n        var removedNodes = map(records, function (v) {\r\n            return grep(v.removedNodes, function (v) {\r\n                return v.nodeType === 1 && !containsOrEquals(element, v);\r\n            });\r\n        });\r\n        if (removedNodes[0]) {\r\n            state.handlers.forEach(function (callback) {\r\n                callback(removedNodes.slice(0));\r\n            });\r\n            each(state.map, function (child, handlers) {\r\n                if (!containsOrEquals(element, child) && mapRemove(state.map, child)) {\r\n                    handlers.forEach(function (callback) {\r\n                        callback(child);\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\ninitDetachWatcher(root);\r\n\r\nexport {\r\n    observe,\r\n    registerCleanup,\r\n    afterDetached,\r\n    watchElements,\r\n    watchAttributes\r\n};\r\n","import dom from \"./dom.js\";\r\nimport { comparePosition, containsOrEquals, createTreeWalker, is, iterateNode, parentsAndSelf } from \"./domUtil.js\";\r\nimport { ZetaEventContainer } from \"./events.js\";\r\nimport { observe } from \"./observe.js\";\r\nimport { Map, WeakMap } from \"./shim.js\"\r\nimport { createPrivateStore, defineHiddenProperty, defineOwnProperty, definePrototype, each, equal, extend, grep, isPlainObject, kv, map, mapGet, mapRemove } from \"./util.js\";\r\n\r\nconst _ = createPrivateStore();\r\nconst setPrototypeOf = Object.setPrototypeOf;\r\nconst collectMutations = observe(dom.root, handleMutations);\r\n\r\n/** @type {WeakMap<Element, VersionState>} */\r\nvar versionMap = new WeakMap();\r\nvar version = 0;\r\n\r\n/* --------------------------------------\r\n * Helper functions\r\n * -------------------------------------- */\r\n\r\nfunction throwOrReturn(result, throwError, message) {\r\n    if (!result && throwError) {\r\n        throw new Error(message);\r\n    }\r\n    return result;\r\n}\r\n\r\nfunction assertSameTree(tree, node, throwError) {\r\n    var assert = _(node).tree === tree;\r\n    return throwOrReturn(assert, throwError, 'Node does not belongs to this tree');\r\n}\r\n\r\nfunction assertDescendantOfTree(tree, element, throwError) {\r\n    var assert = containsOrEquals(tree, element);\r\n    return throwOrReturn(assert, throwError, 'Element must be a descendant of the root node');\r\n}\r\n\r\n/**\r\n * @class\r\n * @property {number} version\r\n */\r\nfunction VersionState() {\r\n    this.version = version;\r\n}\r\n\r\nfunction initNode(tree, node, element) {\r\n    var sNode = _(node, {\r\n        version: version,\r\n        tree: tree,\r\n        node: node,\r\n        traversable: is(node, TraversableNode),\r\n        state: mapGet(versionMap, element, VersionState),\r\n        childNodes: []\r\n    });\r\n    (containsOrEquals(tree.element, element) ? _(tree).nodes : _(tree).detached).set(element, sNode);\r\n    defineHiddenProperty(node, 'element', element, true);\r\n    if (tree.rootNode) {\r\n        insertNode(sNode);\r\n    }\r\n    return sNode;\r\n}\r\n\r\nfunction findNode(tree, element, returnParent) {\r\n    var sTree = _(tree);\r\n    var sNode = sTree.nodes.get(element) || sTree.detached.get(element) || (returnParent && findParent(tree, element));\r\n    return sNode && checkNodeState(sNode);\r\n}\r\n\r\nfunction findParent(tree, element) {\r\n    if (!element) {\r\n        element = tree.node.element;\r\n        tree = tree.tree;\r\n    }\r\n    if (element !== tree.element) {\r\n        var sTree = _(tree);\r\n        element = element.parentNode;\r\n        for (; element !== tree.element; element = element.parentNode) {\r\n            var result = sTree.nodes.get(element) || sTree.detached.get(element);\r\n            if (result) {\r\n                return result;\r\n            }\r\n        }\r\n    }\r\n    return _(tree.rootNode);\r\n}\r\n\r\nfunction checkNodeState(sNode) {\r\n    collectMutations();\r\n    if (sNode.version !== sNode.state.version) {\r\n        updateTree(sNode.tree);\r\n    }\r\n    return sNode;\r\n}\r\n\r\nfunction insertNode(sNode) {\r\n    return (sNode.traversable ? insertTraversableNode : insertInheritedNode)(sNode);\r\n}\r\n\r\nfunction removeNode(sNode, keepNode) {\r\n    if (!keepNode) {\r\n        var sTree = _(sNode.tree);\r\n        var element = sNode.node.element;\r\n        if (!mapRemove(sTree.nodes, element)) {\r\n            // the node is already removed from the tree\r\n            // therefore nothing to do\r\n            return false;\r\n        }\r\n        sTree.detached.set(element, sNode);\r\n    }\r\n    return (sNode.traversable ? removeTraversableNode : removeInheritedNode)(sNode);\r\n}\r\n\r\nfunction insertChildNode(sParent, sChild) {\r\n    if (sParent === sChild || sChild.parentNode === sParent.node) {\r\n        return false;\r\n    }\r\n    if (sChild.parentNode) {\r\n        removeNode(sChild, true);\r\n    }\r\n    var childNodes = sChild.childNodes;\r\n    var parentChildNodes = sParent.childNodes;\r\n    var pos = parentChildNodes.length;\r\n    for (var i = pos - 1; i >= 0; i--) {\r\n        var v = comparePosition(parentChildNodes[i], sChild.node, true);\r\n        if (v < 0) {\r\n            break;\r\n        }\r\n        pos = i;\r\n        if (v !== v) {\r\n            _(parentChildNodes[i]).parentNode = sChild.node;\r\n            childNodes.unshift(parentChildNodes.splice(i, 1)[0]);\r\n        }\r\n    }\r\n    sChild.parentNode = sParent.node;\r\n    parentChildNodes.splice(pos, 0, sChild.node);\r\n    return [pos, childNodes, parentChildNodes];\r\n}\r\n\r\nfunction insertTraversableNode(sNode) {\r\n    var sParent = findParent(sNode);\r\n    var result = insertChildNode(sParent, sNode);\r\n    if (result) {\r\n        var empty = {};\r\n        var childNodes = result[1];\r\n        if (childNodes[0]) {\r\n            var s1 = _(childNodes[0]);\r\n            var s2 = _(childNodes[childNodes.length - 1]);\r\n            var previousSilbing = s1.previousSilbing;\r\n            var nextSibling = s2.nextSibling;\r\n            (_(previousSilbing) || empty).nextSibling = nextSibling;\r\n            (_(nextSibling) || empty).previousSilbing = previousSilbing;\r\n            (s1 || empty).previousSilbing = null;\r\n            (s2 || empty).nextSibling = null;\r\n        }\r\n        var parentChildNodes = result[2];\r\n        if (parentChildNodes[1]) {\r\n            var pos = result[0];\r\n            var p1 = parentChildNodes[pos - 1];\r\n            var p2 = parentChildNodes[pos + 1];\r\n            sNode.nextSibling = p2;\r\n            sNode.previousSilbing = p1;\r\n            (_(p1) || empty).nextSibling = sNode.node;\r\n            (_(p2) || empty).previousSilbing = sNode.node;\r\n        }\r\n    }\r\n    return !!result;\r\n}\r\n\r\nfunction insertInheritedNode(sNode) {\r\n    var sParent = findParent(sNode);\r\n    var result = insertChildNode(sParent, sNode);\r\n    if (result) {\r\n        setPrototypeOf(sNode.node, sParent.node);\r\n        each(result[1], function (i, v) {\r\n            setPrototypeOf(v, sNode.node);\r\n        });\r\n    }\r\n    return !!result;\r\n}\r\n\r\nfunction removeTraversableNode(sNode) {\r\n    var parent = sNode.parentNode;\r\n    if (!parent) {\r\n        return false;\r\n    }\r\n    var childNodes = sNode.childNodes.splice();\r\n    var parentChildNodes = _(parent).childNodes;\r\n    var pos = parentChildNodes.indexOf(sNode.node);\r\n    sNode.parentNode = null;\r\n    if (childNodes[0]) {\r\n        var states = map(childNodes, function (v) {\r\n            return _(v);\r\n        });\r\n        states[0].previousSilbing = parentChildNodes[pos - 1];\r\n        states[states.length - 1].nextSibling = parentChildNodes[pos + 1];\r\n        each(states, function (i, v) {\r\n            v.parentNode = parent;\r\n        });\r\n    }\r\n    parentChildNodes.splice.apply(parentChildNodes, [pos, 1].concat(childNodes));\r\n    return true;\r\n}\r\n\r\nfunction removeInheritedNode(sNode) {\r\n    var updated = removeTraversableNode(sNode);\r\n    each(sNode.childNodes, function (i, v) {\r\n        setPrototypeOf(v, sNode.parentNode);\r\n    });\r\n    setPrototypeOf(sNode.node, InheritedNode.prototype);\r\n    return updated;\r\n}\r\n\r\nfunction reorderTraversableChildNodes(sNode) {\r\n    var childNodes = sNode.childNodes;\r\n    var copy = childNodes.slice();\r\n    var updated = false;\r\n    for (var i = copy.length - 1; i >= 0; i--) {\r\n        if (!containsOrEquals(sNode.tree, copy[i])) {\r\n            // @ts-ignore: boolean arithmetics\r\n            updated |= removeTraversableNode(_(copy[i]));\r\n        }\r\n    }\r\n    if (childNodes.length > 1) {\r\n        copy = childNodes.slice(0);\r\n        childNodes.sort(comparePosition);\r\n        if (!equal(childNodes, copy)) {\r\n            each(childNodes, function (i, v) {\r\n                extend(_(v), {\r\n                    previousSilbing: childNodes[i - 1],\r\n                    nextSibling: childNodes[i + 1]\r\n                });\r\n            });\r\n            updated = true;\r\n        }\r\n    }\r\n    return updated;\r\n}\r\n\r\nfunction updateTree(tree) {\r\n    var sTree = _(tree);\r\n    var updatedNodes = map(sTree.nodes, function (sNode, element) {\r\n        var newVersion = sNode.state.version;\r\n        var updated = false;\r\n        if (sNode.version !== newVersion) {\r\n            var connected = containsOrEquals(tree, element);\r\n            if (sNode.traversable) {\r\n                // @ts-ignore: boolean arithmetics\r\n                updated |= reorderTraversableChildNodes(sNode);\r\n            }\r\n            // @ts-ignore: boolean arithmetics\r\n            updated |= (connected ? insertNode : removeNode)(sNode);\r\n            sNode.version = newVersion;\r\n            if (connected) {\r\n                var iterator = createTreeWalker(element, 1, function (v) {\r\n                    return v !== element && sTree.nodes.has(v) ? 2 : 1;\r\n                });\r\n                iterateNode(iterator, function (element) {\r\n                    var recovered = mapRemove(sTree.detached, element);\r\n                    if (recovered) {\r\n                        insertNode(recovered);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n        return updated ? sNode.node : null;\r\n    });\r\n    sTree.version = version;\r\n    if (updatedNodes[0]) {\r\n        sTree.container.emit('update', tree, { updatedNodes }, false);\r\n    }\r\n}\r\n\r\nfunction handleMutations(mutations) {\r\n    var empty = {};\r\n    each(mutations, function (i, v) {\r\n        var addedElm = grep(v.addedNodes, function (v) {\r\n            return is(v, 1);\r\n        });\r\n        var removedElm = grep(v.removedNodes, function (v) {\r\n            return is(v, 1);\r\n        });\r\n        if (addedElm[0] || removedElm[0]) {\r\n            version++;\r\n            each(parentsAndSelf(v.target).concat(addedElm, removedElm), function (i, v) {\r\n                (mapGet(versionMap, v) || empty).version = version;\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\n/* --------------------------------------\r\n * Classes\r\n * -------------------------------------- */\r\n\r\nfunction createNodeClass(baseClass, constructor) {\r\n    constructor = constructor || function () { };\r\n    if (is(constructor.prototype, baseClass)) {\r\n        return constructor;\r\n    }\r\n    function Node(tree, element) {\r\n        baseClass.call(this, tree, element);\r\n        constructor.call(this, tree, element);\r\n    }\r\n    definePrototype(constructor, baseClass, constructor.prototype);\r\n    return extend(Node, { prototype: constructor.prototype });\r\n}\r\n\r\nfunction VirtualNode() {\r\n}\r\n\r\nfunction TraversableNode(tree, element) {\r\n    initNode(tree, this, element);\r\n}\r\n\r\ndefinePrototype(TraversableNode, VirtualNode, {\r\n    get parentNode() {\r\n        return checkNodeState(_(this)).parentNode || null;\r\n    },\r\n    get childNodes() {\r\n        return checkNodeState(_(this)).childNodes.slice(0);\r\n    },\r\n    get firstChild() {\r\n        return checkNodeState(_(this)).childNodes[0] || null;\r\n    },\r\n    get lastChild() {\r\n        var arr = checkNodeState(_(this)).childNodes;\r\n        return arr[arr.length - 1] || null;\r\n    },\r\n    get previousSilbing() {\r\n        return checkNodeState(_(this)).previousSilbing || null;\r\n    },\r\n    get nextSibling() {\r\n        return checkNodeState(_(this)).nextSibling || null;\r\n    }\r\n});\r\n\r\nfunction InheritedNode(tree, element) {\r\n    initNode(tree, this, element);\r\n}\r\n\r\ndefinePrototype(InheritedNode, VirtualNode, {\r\n    getComputedValues: function () {\r\n        checkNodeState(_(this));\r\n        return extend({}, this);\r\n    }\r\n});\r\n\r\nfunction NodeTree(baseClass, root, constructor, options) {\r\n    var self = this;\r\n    _(self, extend({}, options, {\r\n        nodeClass: createNodeClass(baseClass, constructor),\r\n        nodes: new Map(),\r\n        detached: new WeakMap(),\r\n        container: new ZetaEventContainer()\r\n    }));\r\n    defineOwnProperty(self, 'element', root, true);\r\n    defineOwnProperty(self, 'rootNode', self.setNode(root), true);\r\n    observe(root, function () {\r\n        updateTree(self);\r\n    });\r\n}\r\n\r\ndefinePrototype(NodeTree, {\r\n    on: function(event, handler) {\r\n        _(this).container.add(this, isPlainObject(event) || kv(event, handler));\r\n    },\r\n    getNode: function (element) {\r\n        if (!assertDescendantOfTree(this, element)) {\r\n            return null;\r\n        }\r\n        var result = findNode(this, element, true);\r\n        return result && result.node;\r\n    },\r\n    setNode: function (element) {\r\n        var self = this;\r\n        var result = findNode(self, element);\r\n        return result ? result.node : new (_(self).nodeClass)(self, element);\r\n    },\r\n    removeNode: function (node) {\r\n        assertSameTree(this, node, true);\r\n        removeNode(_(node));\r\n    }\r\n});\r\n\r\nfunction TraversableNodeTree(root, constructor, options) {\r\n    NodeTree.call(this, TraversableNode, root, constructor, options);\r\n}\r\n\r\ndefinePrototype(TraversableNodeTree, NodeTree);\r\n\r\nfunction InheritedNodeTree(root, constructor, options) {\r\n    NodeTree.call(this, InheritedNode, root, constructor, options);\r\n}\r\n\r\ndefinePrototype(InheritedNodeTree, NodeTree);\r\n\r\nexport {\r\n    TraversableNode,\r\n    TraversableNodeTree,\r\n    InheritedNode,\r\n    InheritedNodeTree\r\n};\r\n","import * as env from \"./env.js\";\r\nimport * as shim from \"./shim.js\";\r\nimport * as _util from \"./util.js\";\r\nimport * as _domUtil from \"./domUtil.js\";\r\nimport * as cssUtil from \"./cssUtil.js\";\r\nimport { ZetaEventContainer } from \"./events.js\";\r\nimport { InheritedNode, InheritedNodeTree, TraversableNode, TraversableNodeTree } from \"./tree.js\";\r\nimport dom from \"./dom.js\";\r\n\r\nconst IS_IOS = env.IS_IOS;\r\nconst IS_IE10 = env.IS_IE10;\r\nconst IS_IE = env.IS_IE;\r\nconst IS_MAC = env.IS_MAC;\r\nconst IS_TOUCH = env.IS_TOUCH;\r\nconst util = { ..._util, ..._domUtil };\r\n\r\nexport default {\r\n    IS_IOS,\r\n    IS_IE10,\r\n    IS_IE,\r\n    IS_MAC,\r\n    IS_TOUCH,\r\n    shim,\r\n    util,\r\n    dom,\r\n    css: cssUtil,\r\n    EventContainer: ZetaEventContainer,\r\n    InheritedNode,\r\n    InheritedNodeTree,\r\n    TraversableNode,\r\n    TraversableNodeTree\r\n};\r\n\r\nexport {\r\n    IS_IOS,\r\n    IS_IE10,\r\n    IS_IE,\r\n    IS_MAC,\r\n    IS_TOUCH,\r\n    shim,\r\n    util,\r\n    dom,\r\n    cssUtil as css,\r\n    ZetaEventContainer as EventContainer,\r\n    InheritedNode,\r\n    InheritedNodeTree,\r\n    TraversableNode,\r\n    TraversableNodeTree\r\n};\r\n","module.exports = __WEBPACK_EXTERNAL_MODULE__804__;","module.exports = __WEBPACK_EXTERNAL_MODULE__44__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(650);\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};"],"sourceRoot":""}